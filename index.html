<!doctype html>

<html lang="en"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f1117">
<title>Nanjing Ramadan 2026</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0d14;--surface:#12151f;--surface2:#1a1e2b;--surface3:#222736;
  --border:#2a2f42;--border2:#353c55;
  --tx:#e8eaf0;--tx2:#8b92aa;--tx3:#5a6278;
  --gold:#e8b86d;--gold2:#f0ca8a;--gold3:#c99840;
  --teal:#2dd4bf;--teal2:#14b8a6;
  --rose:#fb7185;--rose2:#f43f5e;
  --indigo:#818cf8;--indigo2:#6366f1;
  --amber:#fbbf24;--amber2:#f59e0b;
  --emerald:#34d399;--emerald2:#10b981;
  --sky:#38bdf8;--sky2:#0ea5e9;
  --violet:#a78bfa;--violet2:#8b5cf6;
  --orange:#fb923c;--orange2:#f97316;
  --now:#fb7185;
  --radius:16px;--radius-sm:10px;--radius-xs:6px;
  --shadow:0 4px 24px rgba(0,0,0,.4);
  --shadow-sm:0 2px 12px rgba(0,0,0,.3);
  --font:'DM Sans',sans-serif;--font-serif:'Amiri',serif;--font-mono:'DM Mono',monospace;
  --safe-top:env(safe-area-inset-top,0px);
  --safe-bottom:env(safe-area-inset-bottom,0px);
}
body.light{
  --bg:#f0f2f8;--surface:#ffffff;--surface2:#f7f8fc;--surface3:#eef0f7;
  --border:#dde1ef;--border2:#c8cedf;
  --tx:#1a1d2e;--tx2:#5a6278;--tx3:#9aa0b8;
  --shadow:0 2px 16px rgba(0,0,0,.08);--shadow-sm:0 1px 8px rgba(0,0,0,.06);
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
html{height:100%;scroll-behavior:smooth}
body{min-height:100%;font-family:var(--font);background:var(--bg);color:var(--tx);font-size:14px;line-height:1.5;overflow-x:hidden;transition:background .3s,color .3s}
button,input,select,textarea{font:inherit;color:inherit;border:none;background:none;outline:none;cursor:pointer;-webkit-appearance:none;appearance:none}
input[type=date]::-webkit-calendar-picker-indicator{filter:invert(0.7);opacity:0.6}

/* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app{display:flex;flex-direction:column;min-height:100vh;min-height:100dvh;padding-top:calc(var(â€“safe-top) + 4px);padding-bottom:calc(var(â€“safe-bottom) + 72px)}
main{flex:1;padding:0 12px;max-width:960px;margin:0 auto;width:100%}

/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#header{position:sticky;top:0;z-index:60;padding:8px 12px;background:color-mix(in srgb,var(â€“bg) 85%,transparent);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid var(â€“border)}
.hdr-inner{max-width:960px;margin:0 auto}
.hdr-top{display:flex;align-items:center;justify-content:space-between;gap:8px}
.hdr-title{font-family:var(â€“font-serif);font-size:18px;font-weight:700;color:var(â€“gold);letter-spacing:.01em;line-height:1.2}
.hdr-sub{font-size:11px;color:var(â€“tx3);margin-top:1px}
.hdr-actions{display:flex;gap:6px;align-items:center;flex-shrink:0}
.hdr-bar{display:flex;align-items:center;gap:8px;margin-top:6px;flex-wrap:wrap}
.now-badge{display:flex;align-items:center;gap:5px;background:var(â€“surface2);border:1px solid var(â€“border);border-radius:999px;padding:4px 10px;font-size:11px;font-weight:500}
.now-dot{width:6px;height:6px;border-radius:50%;background:var(â€“now);flex-shrink:0;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.6;transform:scale(.85)}}
.next-badge{font-size:11px;color:var(â€“gold);border:1px solid color-mix(in srgb,var(â€“gold) 30%,transparent);border-radius:999px;padding:4px 10px;background:color-mix(in srgb,var(â€“gold) 8%,transparent);max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* â”€â”€ Bottom Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#nav{position:fixed;bottom:0;left:0;right:0;z-index:60;background:color-mix(in srgb,var(â€“bg) 92%,transparent);backdrop-filter:blur(24px) saturate(180%);-webkit-backdrop-filter:blur(24px) saturate(180%);border-top:1px solid var(â€“border);padding-bottom:var(â€“safe-bottom);display:flex;align-items:stretch}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;padding:8px 4px;color:var(â€“tx3);font-size:10px;font-weight:500;transition:color .2s;min-height:54px;border:none;background:none;position:relative}
.nav-btn.on{color:var(â€“gold)}
.nav-btn.on::before{content:â€™â€™;position:absolute;top:0;left:20%;right:20%;height:2px;background:linear-gradient(90deg,var(â€“gold3),var(â€“gold));border-radius:0 0 3px 3px}
.nav-icon{font-size:20px;line-height:1;transition:transform .2s}
.nav-btn.on .nav-icon{transform:scale(1.1)}

/* â”€â”€ Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card{background:var(â€“surface);border:1px solid var(â€“border);border-radius:var(â€“radius);box-shadow:var(â€“shadow-sm);overflow:hidden}
.card+.card,.card+.section-block,.section-block+.card{margin-top:10px}
.section-block{margin-top:10px}
.card-body{padding:14px}
.card-header{padding:12px 14px;border-bottom:1px solid var(â€“border);display:flex;align-items:center;justify-content:space-between;gap:8px}
.card-title{font-weight:700;font-size:13px;letter-spacing:.02em;text-transform:uppercase;color:var(â€“tx2)}

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:5px;border:1px solid var(â€“border2);background:var(â€“surface2);border-radius:var(â€“radius-sm);padding:8px 12px;font-size:12px;font-weight:600;transition:all .15s;white-space:nowrap;min-height:36px}
.btn:active{transform:scale(.96);opacity:.85}
.btn-primary{background:linear-gradient(135deg,var(â€“gold),var(â€“gold3));color:#0a0d14;border-color:transparent;box-shadow:0 2px 12px color-mix(in srgb,var(â€“gold) 30%,transparent)}
.btn-ghost{background:transparent;border-color:var(â€“border)}
.btn-sm{padding:5px 9px;font-size:11px;min-height:28px;border-radius:8px}
.btn-icon{width:36px;height:36px;padding:0;border-radius:var(â€“radius-sm)}

/* â”€â”€ Segment control â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.seg{display:inline-flex;background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);overflow:hidden}
.seg button{padding:7px 12px;font-size:12px;font-weight:600;color:var(â€“tx2);transition:all .15s}
.seg button.on{background:linear-gradient(135deg,var(â€“gold),var(â€“gold3));color:#0a0d14}

/* â”€â”€ Input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.input{background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);padding:8px 10px;font-size:13px;width:100%;transition:border-color .15s}
.input:focus{border-color:var(â€“gold3)}

/* â”€â”€ Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toggle{width:46px;height:26px;border-radius:999px;background:var(â€“surface3);border:1px solid var(â€“border);position:relative;flex-shrink:0;transition:all .2s}
.toggle::after{content:â€™â€™;position:absolute;top:2px;left:2px;width:20px;height:20px;border-radius:50%;background:var(â€“tx3);transition:all .2s}
.toggle.on{background:color-mix(in srgb,var(â€“gold) 20%,transparent);border-color:var(â€“gold3)}
.toggle.on::after{left:22px;background:var(â€“gold)}

/* â”€â”€ Prayer color tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.c-imsak{color:var(â€“teal)} .bg-imsak{background:var(â€“teal)}
.c-fajr{color:var(â€“sky)} .bg-fajr{background:var(â€“sky)}
.c-dhuhr{color:var(â€“indigo)} .bg-dhuhr{background:var(â€“indigo)}
.c-asr{color:var(â€“violet)} .bg-asr{background:var(â€“violet)}
.c-iftar{color:var(â€“orange)} .bg-iftar{background:var(â€“orange)}
.c-maghrib{color:var(â€“amber)} .bg-maghrib{background:var(â€“amber)}
.c-isha{color:var(â€“tx2)} .bg-isha{background:var(â€“tx2)}

/* â”€â”€ Summary page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.stat-card{background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);padding:12px;text-align:center}
.stat-card .label{font-size:10px;color:var(â€“tx3);text-transform:uppercase;letter-spacing:.05em;margin-bottom:4px}
.stat-card .value{font-size:22px;font-weight:800;font-family:var(â€“font-mono);color:var(â€“gold)}
.stat-card .sub{font-size:10px;color:var(â€“tx3);margin-top:2px}
.status-banner{border-radius:var(â€“radius-sm);padding:12px 14px;display:flex;align-items:center;gap:10px;font-weight:600;font-size:14px}
.status-banner.fast{background:color-mix(in srgb,var(â€“gold) 12%,transparent);border:1px solid color-mix(in srgb,var(â€“gold) 25%,transparent);color:var(â€“gold2)}
.status-banner.pre{background:color-mix(in srgb,var(â€“teal) 12%,transparent);border:1px solid color-mix(in srgb,var(â€“teal) 25%,transparent);color:var(â€“teal)}
.status-banner.post{background:color-mix(in srgb,var(â€“indigo) 12%,transparent);border:1px solid color-mix(in srgb,var(â€“indigo) 25%,transparent);color:var(â€“indigo)}
.status-banner.outside{background:var(â€“surface2);border:1px solid var(â€“border);color:var(â€“tx2)}
.status-icon{font-size:24px;flex-shrink:0}

/* â”€â”€ Prayer rows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.prayer-list{display:flex;flex-direction:column;gap:6px}
.prayer-row{display:flex;align-items:center;gap:10px;background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);padding:10px 12px;transition:all .15s}
.prayer-row.highlight{border-color:color-mix(in srgb,var(â€“gold) 40%,transparent);background:color-mix(in srgb,var(â€“gold) 6%,transparent)}
.prayer-row.now-row{border-color:color-mix(in srgb,var(â€“rose) 50%,transparent);background:color-mix(in srgb,var(â€“rose) 6%,transparent);box-shadow:0 0 0 1px color-mix(in srgb,var(â€“rose) 20%,transparent)}
.prayer-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.prayer-name{flex:1;font-weight:600;font-size:13px}
.prayer-sub{font-size:11px;color:var(â€“tx2);margin-top:1px}
.prayer-time{font-family:var(â€“font-mono);font-size:15px;font-weight:700}
.prayer-badge{font-size:10px;padding:2px 7px;border-radius:999px;border:1px solid var(â€“border2);color:var(â€“tx2);white-space:nowrap}
.prayer-badge.upcoming{background:color-mix(in srgb,var(â€“gold) 15%,transparent);border-color:color-mix(in srgb,var(â€“gold) 35%,transparent);color:var(â€“gold2)}
.prayer-badge.passed{opacity:.5}
.prayer-badge.now{background:color-mix(in srgb,var(â€“rose) 15%,transparent);border-color:color-mix(in srgb,var(â€“rose) 40%,transparent);color:var(â€“rose)}

/* â”€â”€ Progress bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.progress-wrap{background:var(â€“surface3);border-radius:999px;height:10px;overflow:hidden;border:1px solid var(â€“border)}
.progress-fill{height:100%;border-radius:999px;background:linear-gradient(90deg,var(â€“teal2),var(â€“amber),var(â€“orange2));transition:width .5s ease;min-width:2px}

/* â”€â”€ Timeline strip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.timeline-strip{position:relative;height:40px;border-radius:var(â€“radius-sm);overflow:hidden;background:var(â€“surface3);border:1px solid var(â€“border)}
.ts-seg{position:absolute;top:0;bottom:0}
.ts-mark{position:absolute;top:0;bottom:0;width:2px}
.ts-label{position:absolute;top:2px;font-size:8px;color:var(â€“tx3);white-space:nowrap;transform:translateX(-50%)}
.ts-now-line{position:absolute;top:0;bottom:0;width:2px;background:var(â€“now);z-index:2}

/* â”€â”€ Calendar view â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cal-toolbar{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.cal-date-display{font-weight:700;font-size:13px;flex:1;min-width:100px}

/* â”€â”€ Week/Day grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.grid-wrap{position:relative;overflow:hidden;border-radius:0 0 var(â€“radius) var(â€“radius)}
.grid-scroll{overflow:auto;-webkit-overflow-scrolling:touch;max-height:calc(100dvh - 260px)}
.grid-inner{position:relative}
.grid-header{display:flex;position:sticky;top:0;z-index:10;background:var(â€“surface)}
.grid-time-col{width:52px;flex-shrink:0;border-right:1px solid var(â€“border)}
.grid-day-col{flex:1;min-width:0;border-right:1px solid var(â€“border);text-align:center;padding:8px 4px}
.grid-day-col:last-child{border-right:none}
.grid-day-col .dow{font-size:10px;color:var(â€“tx2);text-transform:uppercase;letter-spacing:.04em}
.grid-day-col .dom{font-size:16px;font-weight:800}
.grid-day-col .roza-num{font-size:9px;color:var(â€“gold);font-weight:700;font-family:var(â€“font-mono)}
.grid-day-col.today-col .dom{background:var(â€“gold);color:#0a0d14;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;margin:2px auto}
.grid-day-col.selected-col{background:color-mix(in srgb,var(â€“gold) 5%,transparent)}
.grid-day-col.friday-col{background:color-mix(in srgb,var(â€“emerald) 4%,transparent)}
.grid-body{display:flex}
.time-labels{width:52px;flex-shrink:0;position:relative;border-right:1px solid var(â€“border)}
.time-label{position:absolute;right:6px;font-size:10px;color:var(â€“tx3);font-family:var(â€“font-mono);transform:translateY(-50%);user-select:none}
.day-columns{flex:1;display:flex;position:relative}
.day-col{flex:1;position:relative;border-right:1px solid var(â€“border);min-width:0}
.day-col:last-child{border-right:none}
.day-col.today-bg{background:color-mix(in srgb,var(â€“gold) 2%,transparent)}
.hour-line{position:absolute;left:0;right:0;height:1px;background:var(â€“border)}
.half-line{position:absolute;left:0;right:0;height:1px;background:color-mix(in srgb,var(â€“border) 40%,transparent)}
.shade-band{position:absolute;left:0;right:0}
.ev-line{position:absolute;left:0;right:0;height:2px}
.ev-chip{position:absolute;border-radius:5px;padding:1px 4px;font-size:9px;font-weight:700;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border:1px solid rgba(255,255,255,.15);line-height:1.5;cursor:pointer;transition:opacity .1s}
.ev-chip:active{opacity:.7}
.ev-chip.dark-text{color:#0a0d14}
.now-line{position:absolute;left:0;right:0;height:2px;background:var(â€“now);z-index:5;pointer-events:none}
.now-line::before{content:â€™â€™;position:absolute;left:-4px;top:-4px;width:10px;height:10px;border-radius:50%;background:var(â€“now)}

/* â”€â”€ Month calendar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.month-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;padding:10px}
.month-dow{font-size:9px;color:var(â€“tx3);text-align:center;padding:4px 0;text-transform:uppercase;letter-spacing:.04em}
.month-day{min-height:52px;border:1px solid transparent;border-radius:var(â€“radius-sm);padding:5px;cursor:pointer;transition:all .15s;display:flex;flex-direction:column;gap:1px}
.month-day.has-data{background:var(â€“surface2);border-color:var(â€“border)}
.month-day.has-data:active{background:var(â€“surface3)}
.month-day.is-today{border-color:var(â€“gold)!important;background:color-mix(in srgb,var(â€“gold) 8%,transparent)!important}
.month-day.is-selected{border-color:var(â€“sky)!important;background:color-mix(in srgb,var(â€“sky) 8%,transparent)!important}
.month-day.is-friday{background:color-mix(in srgb,var(â€“emerald) 6%,transparent);border-color:color-mix(in srgb,var(â€“emerald) 20%,transparent)}
.month-day.blank{border:none;background:none;cursor:default}
.month-day .day-num{font-size:13px;font-weight:700}
.month-day .day-time{font-size:9px;color:var(â€“tx3);font-family:var(â€“font-mono)}
.month-day .jum-tag{font-size:8px;color:var(â€“emerald);font-weight:700}

/* â”€â”€ Timetable â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.table-wrap{overflow:auto;-webkit-overflow-scrolling:touch;border-radius:0 0 var(â€“radius) var(â€“radius)}
table{width:100%;border-collapse:separate;border-spacing:0;font-size:12px;font-family:var(â€“font-mono)}
thead th{position:sticky;top:0;background:var(â€“surface);color:var(â€“tx2);font-size:10px;font-weight:700;letter-spacing:.04em;text-transform:uppercase;padding:8px 6px;border-bottom:1px solid var(â€“border);z-index:2;white-space:nowrap}
tbody td{padding:7px 6px;border-bottom:1px solid var(â€“border);white-space:nowrap}
tbody tr:last-child td{border-bottom:none}
tbody tr.is-today td{background:color-mix(in srgb,var(â€“gold) 6%,transparent)}
tbody tr.is-friday td:first-child{color:var(â€“emerald)}
tbody tr:hover td{background:var(â€“surface2)}

/* â”€â”€ Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.setting-group{margin-top:10px}
.setting-group-title{font-size:10px;color:var(â€“tx3);text-transform:uppercase;letter-spacing:.06em;font-weight:700;padding:0 4px;margin-bottom:6px}
.setting-row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 14px;border-bottom:1px solid var(â€“border)}
.setting-row:last-child{border-bottom:none}
.setting-label{font-size:13px;font-weight:500}
.setting-sub{font-size:11px;color:var(â€“tx3);margin-top:1px}
.offset-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;padding:12px}
.offset-item{background:var(â€“surface2);border:1px solid var(â€“border);border-radius:var(â€“radius-sm);padding:8px;display:flex;flex-direction:column;gap:4px}
.offset-item label{font-size:10px;color:var(â€“tx2);font-weight:600}
.offset-item input{font-size:13px;font-family:var(â€“font-mono);background:transparent;width:100%;border-bottom:1px solid var(â€“border);padding:2px 0}

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast{position:fixed;left:12px;right:12px;bottom:calc(74px + var(â€“safe-bottom));z-index:100;background:var(â€“surface);border:1px solid var(â€“border2);border-radius:var(â€“radius-sm);padding:10px 14px;box-shadow:var(â€“shadow);transform:translateY(20px);opacity:0;transition:all .25s;pointer-events:none}
#toast.show{transform:translateY(0);opacity:1}
#toast .t-title{font-size:13px;font-weight:700}
#toast .t-sub{font-size:11px;color:var(â€“tx2);margin-top:2px}

/* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(â€“border2);border-radius:999px}

/* â”€â”€ Utility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mt-8{margin-top:8px}.mt-12{margin-top:12px}.flex{display:flex}.items-center{align-items:center}.justify-between{justify-content:space-between}.gap-6{gap:6px}.gap-8{gap:8px}.gap-10{gap:10px}.flex-1{flex:1}.text-sm{font-size:12px;color:var(â€“tx2)}.text-xs{font-size:10px;color:var(â€“tx3)}.font-bold{font-weight:700}.font-mono{font-family:var(â€“font-mono)}.text-gold{color:var(â€“gold)}.hidden{display:none!important}

/* â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.page{animation:fadeIn .2s ease}

/* â”€â”€ Jumuah badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.jum-badge{display:inline-flex;align-items:center;gap:3px;font-size:9px;color:var(â€“emerald);border:1px solid color-mix(in srgb,var(â€“emerald) 30%,transparent);border-radius:999px;padding:1px 5px;margin-top:2px;font-weight:700}

/* â”€â”€ Legend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.legend{display:flex;flex-wrap:wrap;gap:5px}
.legend-item{display:flex;align-items:center;gap:4px;font-size:10px;color:var(â€“tx2);padding:3px 7px;border:1px solid var(â€“border);border-radius:999px;background:var(â€“surface2)}
.legend-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}

/* Ramadan-specific page header */
.page-hero{background:linear-gradient(135deg,color-mix(in srgb,var(â€“gold) 12%,transparent),color-mix(in srgb,var(â€“teal) 6%,transparent));border:1px solid color-mix(in srgb,var(â€“gold) 20%,transparent);border-radius:var(â€“radius);padding:14px;margin-bottom:10px;display:flex;align-items:center;gap:12px}
.page-hero-icon{font-size:32px;flex-shrink:0}
.page-hero-title{font-family:var(â€“font-serif);font-size:16px;color:var(â€“gold2);font-weight:700}
.page-hero-sub{font-size:11px;color:var(â€“tx2);margin-top:2px}

/* Loading */
.skeleton{background:linear-gradient(90deg,var(â€“surface2) 25%,var(â€“surface3) 50%,var(â€“surface2) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* Responsive */
@media(min-width:600px){
.stat-grid{grid-template-columns:repeat(3,1fr)}
.offset-grid{grid-template-columns:repeat(4,1fr)}
}
</style>

</head>
<body>
<div id="app">
  <header id="header">
    <div class="hdr-inner">
      <div class="hdr-top">
        <div>
          <div class="hdr-title" id="hdr-title">Ù†Ø§Ù†Ø¬Ù†Ú¯ Ø±Ù…Ø¶Ø§Ù† 2026</div>
          <div class="hdr-sub" id="hdr-sub">Offline â€¢ Nanjing, China</div>
        </div>
        <div class="hdr-actions">
          <button class="btn btn-sm btn-ghost btn-icon" id="theme-toggle" title="Toggle theme">â˜€</button>
          <div id="hdr-date" class="text-xs font-mono"></div>
        </div>
      </div>
      <div class="hdr-bar">
        <div class="now-badge"><span class="now-dot"></span><span id="now-time"></span></div>
        <div class="next-badge" id="next-badge">â€”</div>
      </div>
    </div>
  </header>

  <main id="main-content">
    <div id="page-summary" class="page hidden"></div>
    <div id="page-cal" class="page hidden"></div>
    <div id="page-day" class="page hidden"></div>
    <div id="page-month" class="page hidden"></div>
    <div id="page-table" class="page hidden"></div>
    <div id="page-settings" class="page hidden"></div>
  </main>

  <nav id="nav">
    <button class="nav-btn" data-tab="summary"><span class="nav-icon">â˜ª</span>Summary</button>
    <button class="nav-btn" data-tab="cal"><span class="nav-icon">ğŸ“…</span>Calendar</button>
    <button class="nav-btn" data-tab="day"><span class="nav-icon">ğŸ•</span>Day</button>
    <button class="nav-btn" data-tab="month"><span class="nav-icon">ğŸ—“</span>Month</button>
    <button class="nav-btn" data-tab="table"><span class="nav-icon">ğŸ“‹</span>Table</button>
    <button class="nav-btn" data-tab="settings"><span class="nav-icon">âš™</span>Settings</button>
  </nav>
</div>
<div id="toast"><div class="t-title" id="toast-title"></div><div class="t-sub" id="toast-sub"></div></div>

<script>
(()=>{
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RAW=[
['2026-02-19','05:13','05:58','13:30','16:25','18:02','18:06','18:59'],
['2026-02-20','05:12','05:57','13:30','16:26','18:03','18:07','19:00'],
['2026-02-21','05:11','05:56','13:30','16:27','18:04','18:08','19:01'],
['2026-02-22','05:10','05:55','13:30','16:27','18:04','18:09','19:02'],
['2026-02-23','05:09','05:54','13:30','16:28','18:05','18:10','19:03'],
['2026-02-24','05:08','05:53','13:30','16:29','18:06','18:10','19:03'],
['2026-02-25','05:07','05:52','13:30','16:29','18:07','18:11','19:04'],
['2026-02-26','05:06','05:51','13:30','16:30','18:07','18:12','19:05'],
['2026-02-27','05:05','05:50','13:30','16:31','18:08','18:12','19:05'],
['2026-02-28','05:04','05:49','13:30','16:31','18:09','18:13','19:06'],
['2026-03-01','05:02','05:47','13:30','16:32','18:10','18:14','19:07'],
['2026-03-02','05:01','05:46','13:30','16:33','18:10','18:15','19:08'],
['2026-03-03','05:00','05:45','13:30','16:33','18:11','18:16','19:09'],
['2026-03-04','04:59','05:44','13:30','16:34','18:12','18:16','19:09'],
['2026-03-05','04:58','05:43','13:30','16:35','18:13','18:17','19:10'],
['2026-03-06','04:57','05:42','13:30','16:35','18:14','18:18','19:11'],
['2026-03-07','04:55','05:40','13:30','16:36','18:15','18:19','19:12'],
['2026-03-08','04:54','05:39','13:30','16:36','18:15','18:20','19:13'],
['2026-03-09','04:53','05:38','13:30','16:37','18:16','18:20','19:13'],
['2026-03-10','04:52','05:37','13:30','16:37','18:17','18:21','19:14'],
['2026-03-11','04:51','05:36','13:30','16:38','18:18','18:22','19:15'],
['2026-03-12','04:49','05:34','13:30','16:38','18:18','18:23','19:16'],
['2026-03-13','04:48','05:33','13:30','16:39','18:19','18:24','19:17'],
['2026-03-14','04:47','05:32','13:30','16:40','18:20','18:24','19:17'],
['2026-03-15','04:45','05:30','13:30','16:40','18:21','18:25','19:18'],
['2026-03-16','04:44','05:29','13:30','16:41','18:21','18:26','19:19'],
['2026-03-17','04:43','05:28','13:30','16:41','18:22','18:26','19:19'],
['2026-03-18','04:42','05:27','13:30','16:42','18:22','18:27','19:20'],
['2026-03-19','04:40','05:25','13:30','16:42','18:23','18:27','19:20'],
['2026-03-20','04:39','05:24','13:30','16:42','18:24','18:28','19:21']
];
const PRAYERS=['imsak','fajr','dhuhr','asr','iftar','maghrib','isha'];
const COLORS={imsak:'var(--teal)',fajr:'var(--sky)',dhuhr:'var(--indigo)',asr:'var(--violet)',iftar:'var(--orange)',maghrib:'var(--amber)',isha:'#64748b'};
const DARK_TEXT={iftar:true,maghrib:true};
const LS='ram_nj26';

// â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DEF={tab:'summary',lang:'en',theme:'dark',fmt:'24',ws:'monday',alerts:1,sound:1,vib:1,shade:1,fshade:1,dual:0,goff:0,off:{imsak:0,fajr:0,dhuhr:0,asr:0,iftar:0,maghrib:0,isha:0}};
let S=Object.assign({},DEF,JSON.parse(localStorage.getItem(LS)||'{}'));
S.off=Object.assign({},DEF.off,S.off||{});
let DATA=(JSON.parse(localStorage.getItem(LS+'_data')||'null')||RAW).map(a=>({date:a[0],imsak:a[1],fajr:a[2],dhuhr:a[3],asr:a[4],iftar:a[5],maghrib:a[6],isha:a[7]}));

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let selectedDate=today();
let calView='week';
let calScrollY=null;
let audioCtx;

// â”€â”€ I18N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const NAMES={
  en:{imsak:'Sehri/Imsak',fajr:'Fajr',dhuhr:'Dhuhr',asr:'Asr',iftar:'Iftar',maghrib:'Maghrib',isha:'Isha',jum:'Jumuah'},
  ur:{imsak:'Ø³Ø­Ø±ÛŒ',fajr:'ÙØ¬Ø±',dhuhr:'Ø¸ÛØ±',asr:'Ø¹ØµØ±',iftar:'Ø§ÙØ·Ø§Ø±',maghrib:'Ù…ØºØ±Ø¨',isha:'Ø¹Ø´Ø§Ø¡',jum:'Ø¬Ù…Ø¹Û'},
  zh:{imsak:'å°æ–‹',fajr:'æ™¨ç¤¼',dhuhr:'æ™Œç¤¼',asr:'æ™¡ç¤¼',iftar:'å¼€æ–‹',maghrib:'æ˜ç¤¼',isha:'å®µç¤¼',jum:'ä¸»éº»'}
};
const LABELS={
  en:{summary:'Summary',calendar:'Calendar',day:'Day View',month:'Month',table:'Timetable',settings:'Settings',today:'Today',prev:'â€¹',next:'â€º',week:'Week',day:'Day',roza:'Roza',done:'Done',left:'Left',status:'Status',next_prayer:'Next Prayer',to_iftar:'To Iftar',to_sehri:'Next Sehri',progress:'Fast Progress',jum:'Jumuah',theme:'Theme',lang:'Language',fmt:'Time Format',ws:'Week Starts',alerts:'Alerts',sound:'Alert Sound',vib:'Vibration',dual:'Dual Labels',shade:'Day/Night Shading',fshade:'Fasting Shading',offsets:'Prayer Offsets',global_off:'Global',export:'Export CSV',import:'Import CSV',reset:'Reset All',save:'Saved!',apply:'Apply',paste_csv:'Paste CSV data',copied:'Copied to clipboard',fast_progress:'Fasting time elapsed',range:'Ramadan',before:'Before Ramadan',after:'Ramadan Ended',pre_sehri:'Before Sehri Cutoff',fasting:'Fasting in Progress',post_iftar:'After Iftar'},
  ur:{summary:'Ø®Ù„Ø§ØµÛ',calendar:'Ú©ÛŒÙ„Ù†ÚˆØ±',day:'Ø¯Ù†',month:'Ù…ÛÛŒÙ†Û',table:'Ø§ÙˆÙ‚Ø§Øª',settings:'ØªØ±ØªÛŒØ¨Ø§Øª',today:'Ø¢Ø¬',prev:'â€¹',next:'â€º',week:'ÛÙØªÛ',day_btn:'Ø¯Ù†',roza:'Ø±ÙˆØ²Û',done:'Ù…Ú©Ù…Ù„',left:'Ø¨Ø§Ù‚ÛŒ',status:'Ø­Ø§Ù„Øª',next_prayer:'Ø§Ú¯Ù„ÛŒ Ù†Ù…Ø§Ø²',to_iftar:'Ø§ÙØ·Ø§Ø± ØªÚ©',to_sehri:'Ø§Ú¯Ù„ÛŒ Ø³Ø­Ø±ÛŒ',progress:'Ù¾ÛŒØ´Ø±ÙØª',jum:'Ø¬Ù…Ø¹Û',theme:'ØªÚ¾ÛŒÙ…',lang:'Ø²Ø¨Ø§Ù†',fmt:'ÙˆÙ‚Øª',ws:'ÛÙØªÛ',alerts:'Ø§Ù„Ø±Ù¹Ø³',sound:'Ø¢ÙˆØ§Ø²',vib:'ÙˆØ§Ø¦Ø¨Ø±ÛŒØ´Ù†',dual:'ÚˆÙˆØ¦Ù„',shade:'Ø´ÛŒÚˆÙ†Ú¯',fshade:'Ø±ÙˆØ²Û Ø´ÛŒÚˆÙ†Ú¯',offsets:'Ø¢ÙØ³ÛŒÙ¹',global_off:'Ú¯Ù„ÙˆØ¨Ù„',export:'CSV',import:'Ø¯Ø±Ø¢Ù…Ø¯',reset:'Ø±ÛŒ Ø³ÛŒÙ¹',save:'Ù…Ø­ÙÙˆØ¸',apply:'Ù„Ø§Ú¯Ùˆ',paste_csv:'CSV',copied:'Ú©Ø§Ù¾ÛŒ ÛÙˆ Ú¯Ø¦ÛŒ',fast_progress:'Ø±ÙˆØ²Û’ Ú©ÛŒ Ù¾ÛŒØ´Ø±ÙØª',range:'Ø±Ù…Ø¶Ø§Ù†',before:'Ø±Ù…Ø¶Ø§Ù† Ø³Û’ Ù¾ÛÙ„Û’',after:'Ø±Ù…Ø¶Ø§Ù† Ø®ØªÙ…',pre_sehri:'Ø³Ø­Ø±ÛŒ Ø³Û’ Ù¾ÛÙ„Û’',fasting:'Ø±ÙˆØ²Û Ø¬Ø§Ø±ÛŒ',post_iftar:'Ø§ÙØ·Ø§Ø± Ú©Û’ Ø¨Ø¹Ø¯'},
  zh:{summary:'æ¦‚è§ˆ',calendar:'æ—¥å†',day:'å½“å¤©',month:'æœˆä»½',table:'æ—¶é—´è¡¨',settings:'è®¾ç½®',today:'ä»Šå¤©',prev:'â€¹',next:'â€º',week:'å‘¨',day_btn:'æ—¥',roza:'å¤©æ•°',done:'å·²å®Œæˆ',left:'å‰©ä½™',status:'çŠ¶æ€',next_prayer:'ä¸‹ä¸€æ¬¡',to_iftar:'è·å¼€æ–‹',to_sehri:'è·å°æ–‹',progress:'å°æ–‹è¿›åº¦',jum:'ä¸»éº»',theme:'ä¸»é¢˜',lang:'è¯­è¨€',fmt:'æ—¶é—´åˆ¶',ws:'å‘¨å¼€å§‹',alerts:'æé†’',sound:'å£°éŸ³',vib:'éœ‡åŠ¨',dual:'åŒè¯­',shade:'åº•è‰²',fshade:'å°æ–‹åº•è‰²',offsets:'åç§»',global_off:'å…¨å±€',export:'å¯¼å‡ºCSV',import:'å¯¼å…¥CSV',reset:'é‡ç½®',save:'å·²ä¿å­˜',apply:'åº”ç”¨',paste_csv:'ç²˜è´´CSV',copied:'å·²å¤åˆ¶',fast_progress:'å°æ–‹è¿›åº¦',range:'æ–‹æˆ’',before:'å°šæœªå¼€å§‹',after:'å·²ç»“æŸ',pre_sehri:'å°æ–‹å‰',fasting:'æ­£åœ¨å°æ–‹',post_iftar:'å¼€æ–‹å'}
};
function t(k){let l=LABELS[S.lang]||LABELS.en; return l[k]||LABELS.en[k]||k}
function pname(k,isFriday=false){let n=NAMES[S.lang]||NAMES.en; let txt=(k==='dhuhr'&&isFriday)?n.jum:n[k]; if(S.dual&&S.lang!=='en'){let en=NAMES.en; let alt=(k==='dhuhr'&&isFriday)?en.jum:en[k]; txt+=' / '+alt} return txt}
function locale(){return S.lang==='ur'?'ur-PK':S.lang==='zh'?'zh-CN':'en-US'}

// â”€â”€ TIME HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function z(n){return String(n).padStart(2,'0')}
function today(){let d=new Date(); return d.getFullYear()+'-'+z(d.getMonth()+1)+'-'+z(d.getDate())}
function addDays(s,n){let d=parseDate(s); d.setDate(d.getDate()+n); return d.getFullYear()+'-'+z(d.getMonth()+1)+'-'+z(d.getDate())}
function parseDate(s){let[y,m,d]=s.split('-').map(Number); return new Date(y,m-1,d)}
function isFriday(s){return parseDate(s).getDay()===5}
function toMins(t){if(!t)return 0; let m=String(t).match(/(\d{1,2})[:ï¼š](\d{1,2})/); if(!m)return 0; return +m[1]*60+ +m[2]}
function fromMins(x){x=Math.max(0,Math.min(1439,Math.round(x))); return z((x/60)|0)+':'+z(x%60)}
function fmtTime(t){let x=toMins(t); let h=(x/60)|0,mi=x%60; if(S.fmt==='24') return z(h)+':'+z(mi); let ap=h>=12?'PM':'AM',h12=h%12||12; return h12+':'+z(mi)+'\u202f'+ap}
function fmtDur(ms){ms=Math.max(0,ms); let s=(ms/1000)|0,h=(s/3600)|0,mn=((s%3600)/60)|0,se=s%60; return h?`${h}h ${mn}m`:mn?`${mn}m ${se}s`:`${se}s`}
function fmtDate(s,opts={}){return new Intl.DateTimeFormat(locale(),opts).format(parseDate(s))}
function dowShort(s){return new Intl.DateTimeFormat(locale(),{weekday:'short'}).format(parseDate(s))}
function monthLong(y,m){return new Intl.DateTimeFormat(locale(),{month:'long',year:'numeric'}).format(new Date(y,m-1,1))}

// â”€â”€ DATA HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applyOffsets(r){let o={date:r.date}; PRAYERS.forEach(k=>o[k]=fromMins(toMins(r[k])+(+S.goff||0)+(+S.off[k]||0))); return o}
function getRow(s){let r=DATA.find(x=>x.date===s); return r?applyOffsets(r):null}
function rozaIndex(s){let i=DATA.findIndex(r=>r.date===s); return i<0?0:i+1}
function weekDates(anchor){let d=parseDate(anchor),wd=d.getDay(),st=S.ws==='monday'?1:0; d.setDate(d.getDate()-((wd-st+7)%7)); return [...Array(7)].map((_,i)=>addDays(d.getFullYear()+'-'+z(d.getMonth()+1)+'-'+z(d.getDate()),i))}

// â”€â”€ STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getStatus(){
  const t=today(), r=getRow(t), now=new Date(), nm=now.getHours()*60+now.getMinutes()+now.getSeconds()/60;
  const first=DATA[0].date, last=DATA[DATA.length-1].date;
  if(!r){return{in:false,before:t<first,after:t>last,day:t<first?0:DATA.length,comp:t<first?0:DATA.length,left:t<first?DATA.length:0,pct:t<first?0:1,status:t<first?'before':'after',fp:0}};}
  const im=toMins(r.imsak), it=toMins(r.iftar);
  const comp=rozaIndex(t)-1+(nm>=it?1:0);
  const fp=nm<im?0:nm>=it?1:Math.max(0,(nm-im)/(it-im));
  return{in:true,day:rozaIndex(t),comp,left:DATA.length-comp,pct:comp/DATA.length,status:nm<im?'pre':nm<it?'fast':'post',fp,r,t,first,last};
}
function nextPrayer(){
  const s=today(),r=getRow(s); if(!r) return null;
  const now=new Date(),base=parseDate(s);
  for(const k of PRAYERS){
    const mi=toMins(r[k]),dt=new Date(base.getFullYear(),base.getMonth(),base.getDate(),(mi/60)|0,mi%60,0,0);
    if(dt>now) return{k,t:r[k],mi,left:dt-now,j:k==='dhuhr'&&isFriday(s)};
  }
  // next day first prayer
  const s2=addDays(s,1),r2=getRow(s2); if(!r2) return null;
  const k=PRAYERS[0],mi=toMins(r2[k]),b2=parseDate(s2),dt=new Date(b2.getFullYear(),b2.getMonth(),b2.getDate(),(mi/60)|0,mi%60,0,0);
  return{k,t:r2[k],mi,left:dt-now,j:k==='dhuhr'&&isFriday(s2)};
}

// â”€â”€ PERSIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveSettings(){localStorage.setItem(LS,JSON.stringify(S))}
function saveData(){localStorage.setItem(LS+'_data',JSON.stringify(DATA.map(r=>[r.date,r.imsak,r.fajr,r.dhuhr,r.asr,r.iftar,r.maghrib,r.isha])))}

// â”€â”€ AUDIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function beep(){
  try{
    const C=window.AudioContext||window.webkitAudioContext;if(!C)return;
    audioCtx=audioCtx||new C();if(audioCtx.state==='suspended')audioCtx.resume();
    const o=audioCtx.createOscillator(),g=audioCtx.createGain();
    o.frequency.value=830;o.type='sine';o.connect(g);g.connect(audioCtx.destination);
    const t=audioCtx.currentTime;g.gain.value=.0001;g.gain.exponentialRampToValueAtTime(.07,t+.01);g.gain.exponentialRampToValueAtTime(.0001,t+.3);
    o.start(t);o.stop(t+.32);
  }catch(e){}
}
document.addEventListener('click',()=>{if(audioCtx&&audioCtx.state==='suspended')audioCtx.resume().catch(()=>{})},{passive:true});

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let toastTimer;
function toast(title,sub=''){
  const el=document.getElementById('toast');
  document.getElementById('toast-title').textContent=title;
  document.getElementById('toast-sub').textContent=sub;
  el.classList.add('show');clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>el.classList.remove('show'),2800);
}

// â”€â”€ ALERTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkAlerts(){
  if(!S.alerts)return;
  const s=today(),r=getRow(s);if(!r)return;
  const now=new Date(),hhmm=z(now.getHours())+':'+z(now.getMinutes());
  const key=s+'_'+hhmm;
  if(localStorage.getItem(LS+'_alert')===key)return;
  const ev=PRAYERS.map(k=>({k,t:r[k]})).find(e=>e.t===hhmm);
  if(ev){
    localStorage.setItem(LS+'_alert',key);
    toast('ğŸ•Œ '+pname(ev.k,ev.k==='dhuhr'&&isFriday(s)),fmtTime(ev.t)+' â€¢ '+t('today'));
    if(S.vib&&navigator.vibrate)navigator.vibrate([150,60,150]);
    if(S.sound)beep();
  }
}

// â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateHeader(){
  document.body.classList.toggle('light',S.theme==='light');
  const now=new Date();
  document.getElementById('hdr-date').textContent=new Intl.DateTimeFormat(locale(),{month:'short',day:'numeric',weekday:'short'}).format(now);
  document.getElementById('now-time').textContent=new Intl.DateTimeFormat(locale(),{hour:'numeric',minute:'2-digit',second:'2-digit',hour12:S.fmt==='12'}).format(now);
  const nx=nextPrayer();
  document.getElementById('next-badge').textContent=nx?`â–¶ ${pname(nx.k,nx.j)} Â· ${fmtDur(nx.left)}`:'â€”';
  document.getElementById('theme-toggle').textContent=S.theme==='dark'?'â˜€':'â˜¾';
}

// â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initNav(){
  document.querySelectorAll('.nav-btn').forEach(btn=>{
    btn.onclick=()=>{S.tab=btn.dataset.tab;saveSettings();renderPage()};
  });
}
function updateNav(){
  document.querySelectorAll('.nav-btn').forEach(btn=>btn.classList.toggle('on',btn.dataset.tab===S.tab));
  document.querySelectorAll('[id^="page-"]').forEach(p=>p.classList.add('hidden'));
  const pg=document.getElementById('page-'+S.tab);if(pg)pg.classList.remove('hidden');
}

// â”€â”€ PAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPage(){updateNav();updateHeader();
  switch(S.tab){case 'summary':renderSummary();break;case 'cal':renderCal();break;case 'day':renderDay();break;case 'month':renderMonth();break;case 'table':renderTable();break;case 'settings':renderSettings();break;}
}

// â•â• SUMMARY PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSummary(){
  const pg=document.getElementById('page-summary');
  const st=getStatus(),nx=nextPrayer();
  const statusInfo={
    before:{cls:'outside',icon:'ğŸŒ™',text:t('before')},
    after:{cls:'outside',icon:'ğŸ',text:t('after')},
    pre:{cls:'pre',icon:'ğŸŒ…',text:t('pre_sehri')},
    fast:{cls:'fast',icon:'ğŸŒ¿',text:t('fasting')},
    post:{cls:'post',icon:'â­',text:t('post_iftar')}
  }[st.status]||{cls:'outside',icon:'â€”',text:'â€”'};

  const r=st.r;
  let todayPrayersHtml='';
  if(r){
    const nowMs=Date.now();
    const prayers=PRAYERS.map(k=>{
      const mi=toMins(r[k]);
      const base=parseDate(st.t);
      const dt=new Date(base.getFullYear(),base.getMonth(),base.getDate(),(mi/60)|0,mi%60,0,0);
      const diff=dt-nowMs;
      const isNow=Math.abs(diff)<60000,isPassed=diff<-60000,isUpcoming=!isNow&&!isPassed;
      const j=k==='dhuhr'&&isFriday(st.t);
      const highlight=k==='imsak'||k==='iftar';
      return `<div class="prayer-row${isNow?' now-row':highlight?' highlight':''}">
        <span class="prayer-dot" style="background:${COLORS[k]}"></span>
        <div class="flex-1">
          <div class="prayer-name">${pname(k,j)}${j?`<span class="jum-badge">â–¼ ${t('jum')}</span>`:''}${k==='imsak'||k==='iftar'?'':''}  </div>
          ${isNow?`<div class="prayer-sub">Now!</div>`:''}
        </div>
        <div style="text-align:right">
          <div class="prayer-time" style="color:${COLORS[k]}">${fmtTime(r[k])}</div>
          ${isNow?`<span class="prayer-badge now">Now</span>`:isPassed?`<span class="prayer-badge passed">Done</span>`:isUpcoming?`<span class="prayer-badge upcoming">+${fmtDur(diff)}</span>`:''}
        </div>
      </div>`;
    }).join('');
    todayPrayersHtml=`<div class="prayer-list mt-8">${prayers}</div>`;
  }

  // Timeline strip
  let timelineHtml='';
  if(r){
    const fj=toMins(r.fajr),mg=toMins(r.maghrib),im=toMins(r.imsak),it=toMins(r.iftar);
    const pct=x=>(x/1440*100).toFixed(2)+'%';
    const now=new Date(),nm=now.getHours()*60+now.getMinutes()+now.getSeconds()/60;
    timelineHtml=`<div class="timeline-strip mt-8">
      ${S.shade?`<div class="ts-seg" style="left:0;width:${pct(fj)};background:rgba(15,23,42,.4)"></div>
      <div class="ts-seg" style="left:${pct(fj)};width:${pct(mg-fj)};background:rgba(56,189,248,.08)"></div>
      <div class="ts-seg" style="left:${pct(mg)};width:${pct(1440-mg)};background:rgba(15,23,42,.4)"></div>`:''}
      ${S.fshade?`<div class="ts-seg" style="left:${pct(im)};width:${pct(it-im)};background:rgba(249,115,22,.15)"></div>`:''}
      ${PRAYERS.map(k=>{const mi=toMins(r[k]);return`<div class="ts-mark" style="left:${pct(mi)};background:${COLORS[k]}"></div><div class="ts-label" style="left:${pct(mi)}">${(NAMES[S.lang]||NAMES.en)[k].split('/')[0]}</div>`;}).join('')}
      <div class="ts-now-line" style="left:${pct(nm)}"></div>
    </div>`;
  }

  pg.innerHTML=`
    <div class="page-hero">
      <div class="page-hero-icon">â˜ªï¸</div>
      <div>
        <div class="page-hero-title">Ramadan ${fmtDate(DATA[0].date,{month:'long'})}â€“${fmtDate(DATA[DATA.length-1].date,{month:'long'})} 2026</div>
        <div class="page-hero-sub">${fmtDate(DATA[0].date,{month:'short',day:'numeric'})} â†’ ${fmtDate(DATA[DATA.length-1].date,{month:'short',day:'numeric'})} â€¢ Nanjing, China</div>
      </div>
    </div>
    <div class="stat-grid">
      <div class="stat-card"><div class="label">${t('roza')} #</div><div class="value">${st.in?st.day:'â€”'}</div><div class="sub">of ${DATA.length}</div></div>
      <div class="stat-card"><div class="label">${t('done')}</div><div class="value">${st.comp}</div><div class="sub">&nbsp;</div></div>
      <div class="stat-card"><div class="label">${t('left')}</div><div class="value">${st.left}</div><div class="sub">&nbsp;</div></div>
    </div>
    <div class="card mt-8">
      <div class="card-body">
        <div class="status-banner ${statusInfo.cls}"><span class="status-icon">${statusInfo.icon}</span>${statusInfo.text}</div>
        ${r?`
        <div class="mt-8 flex items-center justify-between gap-6">
          <span class="text-xs">${t('fast_progress')}</span>
          <span class="text-xs font-mono">${(st.fp*100).toFixed(0)}%</span>
        </div>
        <div class="progress-wrap mt-8" style="margin-top:6px"><div class="progress-fill" style="width:${(st.fp*100).toFixed(1)}%"></div></div>
        ${timelineHtml}
        `:'<div class="text-sm mt-8">Outside Ramadan range</div>'}
      </div>
    </div>
    ${r?`<div class="card"><div class="card-header"><span class="card-title">Today's Prayers</span><span class="text-xs">${fmtDate(st.t,{weekday:'long',month:'short',day:'numeric'})}</span></div><div class="card-body">${todayPrayersHtml}</div></div>`:''}
    ${nx?`<div class="card"><div class="card-body"><div class="flex items-center gap-10"><span class="prayer-dot" style="background:${COLORS[nx.k]}"></span><div class="flex-1"><div class="font-bold">${t('next_prayer')}</div><div class="text-sm">${pname(nx.k,nx.j)}</div></div><div style="text-align:right"><div style="font-size:20px;font-weight:800;font-family:var(--font-mono);color:${COLORS[nx.k]}">${fmtDur(nx.left)}</div></div></div></div></div>`:''}
  `;
}

// â•â• CALENDAR PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCal(){
  const pg=document.getElementById('page-cal');
  const dates=calView==='week'?weekDates(selectedDate):[selectedDate];
  const cw=calView==='week'?Math.max(100,Math.min(160,(window.innerWidth-80)/7)):Math.max(260,window.innerWidth-80);
  const hh=calView==='week'?72:96; const ppm=hh/60; const H=hh*24;
  const td=today();

  // Build header
  let hdrCols='<div class="grid-time-col"></div>';
  dates.forEach(s=>{
    const r=getRow(s),isT=s===td,isFr=isFriday(s),isSel=s===selectedDate;
    hdrCols+=`<div class="grid-day-col${isT?' today-col':''}${isSel&&!isT?' selected-col':''}${isFr?' friday-col':''}" data-sel="${s}" style="width:${cw}px;min-width:${cw}px">
      <div class="dow">${dowShort(s)}</div>
      <div class="dom">${parseDate(s).getDate()}</div>
      ${r?`<div class="roza-num">R${z(rozaIndex(s))}</div>`:'<div class="roza-num" style="opacity:0">â€”</div>'}
      ${isFr?`<div class="jum-badge">â–¼</div>`:''}
    </div>`;
  });

  // Build body
  let bodyCols='<div class="time-labels">';
  for(let h=0;h<24;h++) bodyCols+=`<div class="time-label" style="top:${h*hh}px">${fmtTime(z(h)+':00')}</div>`;
  bodyCols+='</div><div class="day-columns" style="width:calc(100% - 52px)">';

  dates.forEach(s=>{
    const r=getRow(s),isT=s===td,isFr=isFriday(s);
    let inner='';
    // Hour/half lines
    for(let h=0;h<24;h++){
      inner+=`<div class="hour-line" style="top:${h*hh}px"></div>`;
      inner+=`<div class="half-line" style="top:${(h+0.5)*hh}px"></div>`;
    }
    if(r){
      const fj=toMins(r.fajr),mg=toMins(r.maghrib),im=toMins(r.imsak),it=toMins(r.iftar);
      if(S.shade){
        inner+=`<div class="shade-band" style="top:0;height:${fj*ppm}px;background:rgba(15,23,42,.25)"></div>`;
        inner+=`<div class="shade-band" style="top:${fj*ppm}px;height:${(mg-fj)*ppm}px;background:rgba(56,189,248,.04)"></div>`;
        inner+=`<div class="shade-band" style="top:${mg*ppm}px;height:${(1440-mg)*ppm}px;background:rgba(15,23,42,.25)"></div>`;
      }
      if(S.fshade) inner+=`<div class="shade-band" style="top:${im*ppm}px;height:${(it-im)*ppm}px;background:rgba(249,115,22,.1)"></div>`;
      // Events with lane assignment to avoid overlap
      const lanes=[];
      PRAYERS.forEach(k=>{
        const mi=toMins(r[k]),y=mi*ppm;
        inner+=`<div class="ev-line" style="top:${y}px;background:${COLORS[k]}"></div>`;
        let lane=0;
        while(lanes[lane]!=null&&lanes[lane]>y-2)lane++;
        lanes[lane]=y+20;
        const lw=calView==='day'?90:56,left=4+lane*lw,j=k==='dhuhr'&&isFriday(s);
        const label=calView==='day'?pname(k,j):(j?t('jum'):pname(k,j));
        inner+=`<div class="ev-chip${DARK_TEXT[k]?' dark-text':''}" style="top:${Math.max(0,y-9)}px;left:${left}px;max-width:${lw-2}px;background:${COLORS[k]}" data-sel="${s}" data-p="${k}">${label}</div>`;
      });
    }
    if(isT){
      const now2=new Date(),ny=(now2.getHours()*60+now2.getMinutes()+now2.getSeconds()/60)*ppm;
      inner+=`<div class="now-line" style="top:${ny}px"></div>`;
    }
    bodyCols+=`<div class="day-col${isT?' today-bg':''}${isFr?' friday-col':''}" style="width:${cw}px;min-width:${cw}px;height:${H}px">${inner}</div>`;
  });
  bodyCols+='</div>';

  pg.innerHTML=`
    <div class="card">
      <div class="card-body">
        <div class="cal-toolbar">
          <div class="seg">
            <button id="cv-week" class="${calView==='week'?'on':''}">${t('week')}</button>
            <button id="cv-day" class="${calView==='day'?'on':''}">${t('day')}</button>
          </div>
          <button class="btn btn-ghost btn-sm" id="cal-prev">${t('prev')}</button>
          <button class="btn btn-ghost btn-sm" id="cal-next">${t('next')}</button>
          <button class="btn btn-primary btn-sm" id="cal-today">${t('today')}</button>
          <input type="date" class="input" id="cal-date" value="${selectedDate}" style="width:130px">
        </div>
        <div class="legend mt-8">
          ${PRAYERS.map(k=>`<div class="legend-item"><span class="legend-dot" style="background:${COLORS[k]}"></span>${pname(k,false)}</div>`).join('')}
          <div class="legend-item"><span class="legend-dot" style="background:var(--now)"></span>Now</div>
        </div>
      </div>
      <div class="grid-wrap">
        <div class="grid-scroll" id="cal-scroll">
          <div class="grid-header" style="min-width:${52+cw*dates.length}px">${hdrCols}</div>
          <div class="grid-inner" style="min-width:${52+cw*dates.length}px;height:${H}px;display:flex">${bodyCols}</div>
        </div>
      </div>
    </div>
  `;

  // Bind
  document.getElementById('cv-week').onclick=()=>{calView='week';renderPage()};
  document.getElementById('cv-day').onclick=()=>{calView='day';renderPage()};
  document.getElementById('cal-prev').onclick=()=>{selectedDate=addDays(selectedDate,calView==='week'?-7:-1);renderPage()};
  document.getElementById('cal-next').onclick=()=>{selectedDate=addDays(selectedDate,calView==='week'?7:1);renderPage()};
  document.getElementById('cal-today').onclick=()=>{selectedDate=today();renderPage()};
  document.getElementById('cal-date').onchange=e=>{selectedDate=e.target.value;renderPage()};
  pg.querySelectorAll('[data-sel]').forEach(el=>{el.onclick=()=>{selectedDate=el.dataset.sel;if(el.dataset.p){S.tab='day';saveSettings();}renderPage();}});

  // Scroll to current time
  const scroll=document.getElementById('cal-scroll');
  if(scroll){
    const now=new Date(),scrollTo=Math.max(0,(now.getHours()*60+now.getMinutes()-90)*(hh/60));
    if(calScrollY===null)scroll.scrollTop=scrollTo;else scroll.scrollTop=calScrollY;
    scroll.onscroll=()=>{calScrollY=scroll.scrollTop};
  }
}

// â•â• DAY PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDay(){
  const pg=document.getElementById('page-day');
  const s=selectedDate, r=getRow(s), isT=s===today();
  const now=new Date(),nm=now.getHours()*60+now.getMinutes()+now.getSeconds()/60;

  let content='';
  if(!r){
    content=`<div class="card"><div class="card-body"><div class="text-sm">No data for this date. Please select a date within Ramadan.</div></div></div>`;
  } else {
    const im=toMins(r.imsak),it=toMins(r.iftar),fj=toMins(r.fajr),mg=toMins(r.maghrib);
    const iftDt=new Date(parseDate(s).getFullYear(),parseDate(s).getMonth(),parseDate(s).getDate(),(it/60)|0,it%60,0,0);
    const nextImRow=getRow(addDays(s,1));
    const nextImDate=nextImRow?parseDate(addDays(s,1)):null;
    let sehriStr='â€”';
    if(nextImRow&&nextImDate){
      if(isT){const imi=toMins(nextImRow.imsak),nd=new Date(nextImDate.getFullYear(),nextImDate.getMonth(),nextImDate.getDate(),(imi/60)|0,imi%60,0,0);sehriStr=fmtDur(nd-now);}
      else sehriStr=fmtTime(nextImRow.imsak)+' '+addDays(s,1).slice(5);
    }
    const iftStr=isT?fmtDur(iftDt-now):fmtTime(r.iftar);
    const fp=isT?Math.max(0,Math.min(1,(nm-im)/(it-im))):0;
    const pct=x=>(x/1440*100).toFixed(2)+'%';

    // status for today's prayers
    const prayers=PRAYERS.map(k=>{
      const mi=toMins(r[k]),j=k==='dhuhr'&&isFriday(s);
      const base=parseDate(s),dt=new Date(base.getFullYear(),base.getMonth(),base.getDate(),(mi/60)|0,mi%60,0,0);
      const diff=isT?dt-now:1;
      const isNow=isT&&Math.abs(diff)<60000,isPassed=isT&&diff<-60000;
      const badge=isNow?'<span class="prayer-badge now">Now</span>':isPassed?'<span class="prayer-badge passed">Passed</span>':isT?`<span class="prayer-badge upcoming">+${fmtDur(diff)}</span>`:'';
      return `<div class="prayer-row${isNow?' now-row':k==='imsak'||k==='iftar'?' highlight':''}">
        <span class="prayer-dot" style="background:${COLORS[k]}"></span>
        <div class="flex-1"><div class="prayer-name">${pname(k,j)}</div>${j?`<div class="prayer-sub">${t('jum')}</div>`:''}</div>
        <div style="text-align:right"><div class="prayer-time" style="color:${COLORS[k]}">${fmtTime(r[k])}</div>${badge}</div>
      </div>`;
    }).join('');

    content=`
      <div class="stat-grid" style="grid-template-columns:1fr 1fr">
        <div class="stat-card"><div class="label">${t('to_iftar')}</div><div class="value" style="font-size:18px">${iftStr}</div></div>
        <div class="stat-card"><div class="label">${t('to_sehri')}</div><div class="value" style="font-size:18px">${sehriStr}</div></div>
      </div>
      <div class="card mt-8">
        <div class="card-body">
          <div class="flex items-center justify-between gap-6"><span class="text-xs">${t('fast_progress')}</span><span class="font-mono text-xs">${(fp*100).toFixed(0)}%</span></div>
          <div class="progress-wrap mt-8" style="margin-top:6px"><div class="progress-fill" style="width:${(fp*100).toFixed(1)}%"></div></div>
          <div class="timeline-strip mt-8">
            ${S.shade?`<div class="ts-seg" style="left:0;width:${pct(fj)};background:rgba(15,23,42,.4)"></div><div class="ts-seg" style="left:${pct(fj)};width:${pct(mg-fj)};background:rgba(56,189,248,.06)"></div><div class="ts-seg" style="left:${pct(mg)};width:${pct(1440-mg)};background:rgba(15,23,42,.4)"></div>`:''}
            ${S.fshade?`<div class="ts-seg" style="left:${pct(im)};width:${pct(it-im)};background:rgba(249,115,22,.18)"></div>`:''}
            ${PRAYERS.map(k=>{const mi=toMins(r[k]);return`<div class="ts-mark" style="left:${pct(mi)};background:${COLORS[k]}"></div>`;}).join('')}
            ${isT?`<div class="ts-now-line" style="left:${pct(nm)}"></div>`:''}
          </div>
        </div>
      </div>
      <div class="card"><div class="card-header"><span class="card-title">Prayer Times</span><span class="text-xs">${rozaIndex(s)?'Roza '+rozaIndex(s)+' of '+DATA.length:''}</span></div><div class="card-body"><div class="prayer-list">${prayers}</div></div></div>
    `;
  }

  pg.innerHTML=`
    <div class="card" style="margin-bottom:10px">
      <div class="card-body">
        <div class="flex items-center gap-8">
          <button class="btn btn-ghost btn-sm" id="day-prev">${t('prev')}</button>
          <div style="flex:1;text-align:center">
            <div class="font-bold">${fmtDate(s,{weekday:'long',month:'long',day:'numeric'})}</div>
            ${isFriday(s)?`<div class="jum-badge" style="margin:4px auto;width:fit-content">â–¼ ${t('jum')}</div>`:''}
          </div>
          <button class="btn btn-ghost btn-sm" id="day-next">${t('next')}</button>
        </div>
        <div class="flex items-center gap-6 mt-8" style="margin-top:10px">
          <input type="date" class="input" id="day-date" value="${s}" style="flex:1">
          <button class="btn btn-primary btn-sm" id="day-today">${t('today')}</button>
        </div>
      </div>
    </div>
    ${content}
  `;

  document.getElementById('day-prev').onclick=()=>{selectedDate=addDays(selectedDate,-1);renderPage()};
  document.getElementById('day-next').onclick=()=>{selectedDate=addDays(selectedDate,1);renderPage()};
  document.getElementById('day-today').onclick=()=>{selectedDate=today();renderPage()};
  document.getElementById('day-date').onchange=e=>{selectedDate=e.target.value;renderPage()};
}

// â•â• MONTH PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMonth(){
  const pg=document.getElementById('page-month');
  const months=[...new Set(DATA.map(r=>r.date.slice(0,7)))];
  const td=today();
  let out='';
  months.forEach(mo=>{
    const[y,mm]=mo.split('-').map(Number);
    const fd=new Date(y,mm-1,1),ld=new Date(y,mm,0);
    const ws=S.ws==='monday'?1:0,pad=(fd.getDay()-ws+7)%7;
    // Day headers
    const dayLabels=[...Array(7)].map((_,i)=>{
      const ref=new Date(2026,1,1+((ws+i)%7));
      return`<div class="month-dow">${new Intl.DateTimeFormat(locale(),{weekday:'short'}).format(ref)}</div>`;
    }).join('');
    // Day cells
    let cells=[...Array(pad)].map(()=>`<div class="month-day blank"></div>`).join('');
    for(let day=1;day<=ld.getDate();day++){
      const s=`${y}-${z(mm)}-${z(day)}`,r=getRow(s),isFr=isFriday(s);
      const cls=['month-day',r?'has-data':'',s===td?'is-today':'',s===selectedDate&&s!==td?'is-selected':'',isFr&&r?'is-friday':''].filter(Boolean).join(' ');
      cells+=`<div class="${cls}" data-s="${s}">
        <div class="day-num" style="${s===td?'color:var(--gold)':''}">${day}</div>
        ${r?`<div class="day-time">${fmtTime(r.imsak)}</div><div class="day-time">${fmtTime(r.iftar)}</div>`:''} 
        ${isFr&&r?`<div class="jum-tag">â–¼ ${(NAMES[S.lang]||NAMES.en).jum}</div>`:''}
      </div>`;
    }
    out+=`<div class="card"><div class="card-header"><span class="font-bold">${monthLong(y,mm)}</span></div><div class="month-grid">${dayLabels}${cells}</div></div>`;
  });
  pg.innerHTML=out;
  pg.querySelectorAll('.month-day.has-data').forEach(el=>{el.onclick=()=>{selectedDate=el.dataset.s;S.tab='day';saveSettings();renderPage();}});
}

// â•â• TABLE PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTable(){
  const pg=document.getElementById('page-table');
  const td=today();
  const rows=DATA.map(applyOffsets);
  const prayerHeaders=PRAYERS.map(k=>`<th>${pname(k,false)}</th>`).join('');
  const tableRows=rows.map((r,i)=>{
    const isFr=isFriday(r.date),isT=r.date===td;
    return`<tr class="${isT?'is-today':''} ${isFr?'is-friday':''}">
      <td>${i+1}</td><td>${r.date}</td><td>${dowShort(r.date)}</td>
      ${PRAYERS.map(k=>`<td style="color:${COLORS[k]}">${fmtTime(r[k])}</td>`).join('')}
    </tr>`;
  }).join('');

  pg.innerHTML=`
    <div class="card" style="margin-bottom:10px">
      <div class="card-body">
        <div class="flex items-center justify-between gap-8">
          <span class="font-bold">Timetable</span>
          <button class="btn btn-sm btn-ghost" id="tbl-export">Export CSV</button>
        </div>
        <div class="text-xs mt-8" style="margin-top:6px">All times include your offset adjustments</div>
      </div>
    </div>
    <div class="card">
      <div class="card-body" style="padding:0">
        <div class="table-wrap">
          <table>
            <thead><tr><th>#</th><th>Date</th><th>Day</th>${prayerHeaders}</tr></thead>
            <tbody>${tableRows}</tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><span class="card-title">Import CSV</span></div>
      <div class="card-body">
        <div class="flex items-center gap-6">
          <input type="file" id="csv-file" class="input" accept=".csv,text/csv" style="flex:1">
          <button class="btn btn-sm" id="csv-import">Import</button>
        </div>
        <div class="text-xs mt-8" style="margin-top:8px">${t('paste_csv')}</div>
        <textarea id="csv-paste" class="input mt-8" style="min-height:80px;margin-top:6px;resize:vertical" placeholder="date,imsak,fajr,dhuhr,asr,iftar,maghrib,isha&#10;2026-02-19,05:13,..."></textarea>

```
    <div class="flex items-center gap-6 mt-8" style="margin-top:8px">
      <button class="btn btn-primary btn-sm" id="csv-apply">${t('apply')}</button>
      <button class="btn btn-ghost btn-sm" id="csv-reset">${t('reset')}</button>
    </div>
  </div>
</div>
```

`;

document.getElementById(â€˜tbl-exportâ€™).onclick=()=>{
const hdr=[â€˜dateâ€™,â€¦PRAYERS],csv=[hdr.join(â€™,â€™),â€¦rows.map(r=>hdr.map(k=>r[k]).join(â€™,â€™))].join(â€™\nâ€™);
const a=document.createElement(â€˜aâ€™);a.href=URL.createObjectURL(new Blob([csv],{type:â€˜text/csvâ€™}));a.download=â€˜nanjing-ramadan-2026.csvâ€™;a.click();setTimeout(()=>URL.revokeObjectURL(a.href),1000);
toast(â€˜Exported!â€™,â€˜CSV downloadedâ€™);
};
document.getElementById(â€˜csv-importâ€™).onclick=async()=>{const f=document.getElementById(â€˜csv-fileâ€™).files[0];if(f)parseCsv(await f.text())};
document.getElementById(â€˜csv-applyâ€™).onclick=()=>{const tx=document.getElementById(â€˜csv-pasteâ€™).value.trim();if(tx)parseCsv(tx);else toast(â€˜Emptyâ€™,â€˜No CSV data providedâ€™)};
document.getElementById(â€˜csv-resetâ€™).onclick=()=>{DATA=RAW.map(a=>({date:a[0],imsak:a[1],fajr:a[2],dhuhr:a[3],asr:a[4],iftar:a[5],maghrib:a[6],isha:a[7]}));saveData();toast(â€˜Resetâ€™,â€˜Data restored to defaultâ€™);renderPage()};
}
function parseCsv(tx){
try{
const lines=tx.replace(/\r/g,â€™â€™).trim().split(â€™\nâ€™).filter(Boolean);
const split=l=>{let o=[],c=â€™â€™,q=0;for(const ch of l){if(ch===â€™â€â€™){q=!q}else if(ch===â€™,â€™&&!q){o.push(c);c=â€™â€™}else c+=ch}o.push(c);return o.map(v=>v.trim())};
if(!lines.length)throw Error(â€˜Empty fileâ€™);
const hdr=split(lines[0]).map(v=>v.toLowerCase());
const di=hdr.indexOf(â€˜dateâ€™);
const pIdx={};PRAYERS.forEach(k=>pIdx[k]=hdr.indexOf(k));
const rows=[];
(di>=0?lines.slice(1):lines).forEach(l=>{
const c=split(l);if(c.length<2)return;
const r={date:di>=0?c[di]:c[0]};
PRAYERS.forEach((k,i)=>{const idx=di>=0?pIdx[k]:i+1;r[k]=c[idx]?c[idx].replace(/[^\d:]/g,â€™â€™):â€˜00:00â€™});
rows.push(r);
});
if(!rows.length)throw Error(â€˜No valid rowsâ€™);
DATA=rows.sort((a,b)=>a.date.localeCompare(b.date));
saveData();toast(â€˜Importedâ€™,rows.length+â€™ rows loadedâ€™);renderPage();
}catch(e){toast(â€˜Import Failedâ€™,e.message)}
}

// â•â• SETTINGS PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSettings(){
const pg=document.getElementById(â€˜page-settingsâ€™);
const togRow=(k,label,sub=â€™â€™)=>` <div class="setting-row"> <div><div class="setting-label">${label}</div>${sub?`<div class="text-xs">${sub}</div>`:''}</div> <div class="toggle${S[k]?' on':''}" id="sw-${k}" data-k="${k}"></div> </div>`;

const offsets=`<div class="offset-grid"> <div class="offset-item"><label>Global</label><input type="number" id="off-global" value="${S.goff}" class="input"></div> ${PRAYERS.map(k=>`<div class="offset-item"><label style="color:${COLORS[k]}">${pname(k,false)}</label><input type="number" id="off-${k}" data-ok="${k}" value="${S.off[k]||0}" class="input"></div>`).join(â€™â€™)}

  </div><div class="text-xs" style="padding:0 12px 10px">Minutes to add (use negative to make earlier)</div>`;

pg.innerHTML=`<div class="card"> <div class="card-header"><span class="card-title">Appearance</span></div> <div class="setting-row"><div class="setting-label">Theme</div> <div class="seg"><button id="s-light" class="${S.theme==='light'?'on':''}">Light</button><button id="s-dark" class="${S.theme==='dark'?'on':''}">Dark</button></div> </div> <div class="setting-row"><div class="setting-label">Language</div> <select class="input" id="s-lang" style="width:auto"><option value="en" ${S.lang==='en'?'selected':''}>English</option><option value="ur" ${S.lang==='ur'?'selected':''}>Ø§Ø±Ø¯Ùˆ</option><option value="zh" ${S.lang==='zh'?'selected':''}>ä¸­æ–‡</option></select> </div> <div class="setting-row"><div class="setting-label">Time Format</div> <div class="seg"><button id="s-24" class="${S.fmt==='24'?'on':''}">24h</button><button id="s-12" class="${S.fmt==='12'?'on':''}">12h</button></div> </div> <div class="setting-row"><div class="setting-label">Week Starts</div> <div class="seg"><button id="s-mon" class="${S.ws==='monday'?'on':''}">Mon</button><button id="s-sun" class="${S.ws==='sunday'?'on':''}">Sun</button></div> </div> </div> <div class="card"> <div class="card-header"><span class="card-title">Display</span></div> ${togRow('shade','Day/Night Shading','Show night/day background on calendar')} ${togRow('fshade','Fasting Shading','Highlight fasting hours in orange')} ${togRow('dual','Dual Language Labels','Show prayer names in two languages')} </div> <div class="card"> <div class="card-header"><span class="card-title">Alerts</span></div> ${togRow('alerts','Enable Alerts','Notify at each prayer time')} ${togRow('sound','Sound','Play a tone at prayer time')} ${togRow('vib','Vibration','Vibrate at prayer time')} </div> <div class="card"> <div class="card-header"><span class="card-title">Time Offsets</span></div> ${offsets} </div> <div class="card"> <div class="card-body"> <div class="flex items-center gap-8"> <button class="btn btn-ghost" id="s-reset">Reset All Settings</button> <button class="btn btn-primary" id="s-copy">Copy Timetable</button> </div> </div> </div>`;

// Theme
pg.querySelector(â€™#s-lightâ€™).onclick=()=>{S.theme=â€˜lightâ€™;saveSettings();renderPage()};
pg.querySelector(â€™#s-darkâ€™).onclick=()=>{S.theme=â€˜darkâ€™;saveSettings();renderPage()};
pg.querySelector(â€™#s-langâ€™).onchange=e=>{S.lang=e.target.value;saveSettings();renderPage()};
pg.querySelector(â€™#s-24â€™).onclick=()=>{S.fmt=â€˜24â€™;saveSettings();renderPage()};
pg.querySelector(â€™#s-12â€™).onclick=()=>{S.fmt=â€˜12â€™;saveSettings();renderPage()};
pg.querySelector(â€™#s-monâ€™).onclick=()=>{S.ws=â€˜mondayâ€™;saveSettings();renderPage()};
pg.querySelector(â€™#s-sunâ€™).onclick=()=>{S.ws=â€˜sundayâ€™;saveSettings();renderPage()};
pg.querySelectorAll(â€™.toggleâ€™).forEach(el=>{el.onclick=()=>{const k=el.dataset.k;S[k]=S[k]?0:1;saveSettings();renderPage()}});
// Offsets
pg.querySelector(â€™#off-globalâ€™).onchange=e=>{S.goff=+e.target.value||0;saveSettings()};
pg.querySelectorAll(â€™[data-ok]â€™).forEach(el=>{el.onchange=()=>{S.off[el.dataset.ok]=+el.value||0;saveSettings()}});
// Reset
pg.querySelector(â€™#s-resetâ€™).onclick=()=>{if(!confirm(â€˜Reset all settings to default?â€™))return;S=JSON.parse(JSON.stringify(DEF));saveSettings();renderPage()};
// Copy
pg.querySelector(â€™#s-copyâ€™).onclick=()=>{
const rows=DATA.map((r,i)=>{const or=applyOffsets(r);return`${i+1}. ${or.date} | Sehri: ${fmtTime(or.imsak)} | Iftar: ${fmtTime(or.iftar)}`}).join(â€™\nâ€™);
navigator.clipboard&&navigator.clipboard.writeText(rows).then(()=>toast(t(â€˜copiedâ€™),â€˜All 30 prayer timesâ€™));
};
}

// â”€â”€ THEME TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initThemeToggle(){
document.getElementById(â€˜theme-toggleâ€™).onclick=()=>{
S.theme=S.theme===â€˜darkâ€™?â€˜lightâ€™:â€˜darkâ€™;saveSettings();updateHeader();
document.body.classList.toggle(â€˜lightâ€™,S.theme===â€˜lightâ€™);
};
}

// â”€â”€ TICK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let lastTab=null;
function tick(){
updateHeader();
const needsFull=S.tab!==lastTab;
if(needsFull){lastTab=S.tab;renderPage();}
else{
switch(S.tab){
case â€˜summaryâ€™:renderSummary();break;
case â€˜dayâ€™:if(s===today())renderDay();break;
}
}
checkAlerts();
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
initNav();initThemeToggle();
document.body.classList.toggle(â€˜lightâ€™,S.theme===â€˜lightâ€™);
renderPage();
setInterval(()=>{
updateHeader();
if(S.tab===â€˜summaryâ€™)renderSummary();
else if(S.tab===â€˜dayâ€™&&selectedDate===today())renderDay();
checkAlerts();
},1000);

})();
</script>

</body></html>