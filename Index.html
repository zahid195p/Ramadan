<!doctype html>
<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1,viewport-fit=cover'><title>Nanjing Ramadan 2026 Offline</title>
<style>
:root{--bg:#f5f7fb;--cd:#fbfcff;--tx:#1f2937;--mu:#64748b;--bd:#dbe3ef;--ac:#4285f4;--ac2:#6aa1ff;--nw:#ef4444;--im:#0ea5a6;--fj:#3b82f6;--dh:#6366f1;--as:#8b5cf6;--if:#f97316;--mg:#f59e0b;--is:#334155;--jm:#16a34a;--ni:rgba(15,23,42,.04);--dy:rgba(59,130,246,.03);--fa:rgba(249,115,22,.08)}
body.dk{--bg:#20242b;--cd:#2b313b;--tx:#e5eaf1;--mu:#a7b2c4;--bd:#3f4756;--ac:#79a8ff;--ac2:#99bcff;--nw:#ff6b6b;--im:#22c5bb;--fj:#7ab6ff;--dh:#9fa8ff;--as:#b495ff;--if:#ff9f5a;--mg:#ffc46b;--is:#c6d2e3;--jm:#34d399;--ni:rgba(15,23,42,.18);--dy:rgba(125,211,252,.04);--fa:rgba(251,146,60,.12)}
*{box-sizing:border-box}html,body{margin:0;height:100%;background:var(--bg);color:var(--tx);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}button,input,select,textarea{font:inherit;color:inherit}
#app{min-height:100vh;padding:env(safe-area-inset-top) 10px env(safe-area-inset-bottom)}
.card{background:var(--cd);border:1px solid var(--bd);border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,.08)}.pad{padding:10px}.top{position:sticky;top:0;z-index:50;padding-top:4px}.r{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}.sm{font-size:12px;color:var(--mu)}.t1{font-weight:800;font-size:15px}
.btn,.in{border:1px solid var(--bd);background:var(--cd);border-radius:10px;padding:7px 9px}.btn.p{background:linear-gradient(var(--ac2),var(--ac));color:#fff;border-color:transparent;font-weight:700}.btn.g{background:color-mix(in srgb,var(--cd) 85%, transparent)}
.tabs{display:flex;gap:6px;overflow:auto;padding:6px}.tabs button{border:0;background:transparent;padding:8px 10px;border-radius:9px;color:var(--mu);white-space:nowrap}.tabs button.on{background:linear-gradient(var(--ac2),var(--ac));color:#fff;font-weight:700}
#pages>section{display:none;margin-top:8px}#pages>section.on{display:block}
.seg{display:inline-flex;border:1px solid var(--bd);border-radius:10px;overflow:hidden}.seg button{border:0;background:transparent;padding:7px 10px;color:var(--mu)}.seg button.on{background:rgba(66,133,244,.14);color:var(--tx);font-weight:700}
.legend{display:flex;flex-wrap:wrap;gap:5px;margin-top:8px}.lg{display:flex;align-items:center;gap:5px;border:1px solid var(--bd);border-radius:999px;padding:3px 6px;font-size:11px;color:var(--mu)}.dot{width:8px;height:8px;border-radius:50%}
.cwrap{margin-top:8px;overflow:hidden}.hsc{overflow-x:auto;border-bottom:1px solid var(--bd)}.hsc::-webkit-scrollbar{display:none}.hin{display:flex}.rh{width:54px;min-width:54px;border-right:1px solid var(--bd)}
.dh{width:var(--cw);min-width:var(--cw);text-align:center;padding:6px 4px;border-right:1px solid var(--bd)}.dh .a{font-size:11px;color:var(--mu)}.dh .b{font-size:14px;font-weight:700}.dh.to{background:rgba(66,133,244,.1)}.dh.se{outline:2px solid rgba(66,133,244,.45);outline-offset:-2px}.dh.ju{box-shadow:inset 0 -3px 0 var(--jm)}.jb{font-size:9px;padding:1px 4px;border-radius:999px;border:1px solid color-mix(in srgb,var(--jm) 35%, var(--bd));color:var(--jm);display:inline-block;margin-top:2px}
.bsc{overflow:auto;max-height:calc(100vh - 255px);background:color-mix(in srgb,var(--cd) 45%, transparent)}.bin{position:relative;width:calc(54px + var(--cc)*var(--cw));height:var(--H)}
.rail{position:sticky;left:0;z-index:3;width:54px;height:100%;border-right:1px solid var(--bd);background:var(--cd)}.tl{position:absolute;right:4px;transform:translateY(-50%);font-size:10px;color:var(--mu)}
.col{position:absolute;top:0;width:var(--cw);height:100%;border-right:1px solid var(--bd);overflow:hidden;background:repeating-linear-gradient(to bottom,transparent 0,transparent calc(var(--hh) - 1px),rgba(100,116,139,.16) calc(var(--hh)-1px),rgba(100,116,139,.16) var(--hh)),repeating-linear-gradient(to bottom,transparent 0,transparent calc(var(--hh)/2 - 1px),rgba(100,116,139,.08) calc(var(--hh)/2 - 1px),rgba(100,116,139,.08) calc(var(--hh)/2))}
.col.to{background-color:rgba(66,133,244,.04)}.col.ju{box-shadow:inset 0 0 0 1px color-mix(in srgb,var(--jm) 30%, transparent)}.bnd{position:absolute;left:0;right:0}.ni{background:var(--ni)}.dy{background:var(--dy)}.fa{background:var(--fa)}
.ln{position:absolute;left:0;right:0;height:2px}.ln:before{content:'';position:absolute;left:0;top:-2px;width:6px;height:6px;border-radius:50%;background:inherit}
.ch{position:absolute;height:18px;line-height:18px;padding:0 4px;transform:scale(var(--mk,1));transform-origin:left top;border-radius:6px;border:1px solid rgba(255,255,255,.18);color:#fff;font-size:10px;font-weight:700;max-width:58px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ch.w{height:20px;line-height:20px;max-width:130px;font-size:11px}.ch.k{color:#111827}.ch.ju{outline:2px solid color-mix(in srgb,var(--jm) 35%, transparent)}
.now{position:absolute;left:0;right:0;height:2px;background:var(--nw)}.now:before{content:'';position:absolute;left:0;top:-4px;width:10px;height:10px;border-radius:50%;background:var(--nw)}.now span{position:absolute;right:4px;top:-11px;background:var(--nw);color:#fff;border-radius:999px;padding:1px 5px;font-size:10px}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:8px}.g3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}@media(max-width:430px){.g2,.g3{grid-template-columns:1fr}}
.m{background:color-mix(in srgb,var(--cd) 88%, transparent);border:1px solid var(--bd);border-radius:12px;padding:10px}.m .k{font-size:11px;color:var(--mu)}.m .v{font-size:18px;font-weight:800;margin-top:4px}
.list{display:flex;flex-direction:column;gap:6px}.rr{display:flex;align-items:center;justify-content:space-between;gap:8px;background:color-mix(in srgb,var(--cd) 88%, transparent);border:1px solid var(--bd);border-radius:10px;padding:7px 8px}.lf{display:flex;gap:8px;align-items:center}.pd{width:10px;height:10px;border-radius:50%}.nm{font-size:12px;font-weight:700}.nt{font-size:10px;color:var(--mu)}.pill{font-size:10px;color:var(--mu);border:1px solid var(--bd);border-radius:999px;padding:2px 6px}
.pb{height:12px;border:1px solid var(--bd);border-radius:999px;overflow:hidden;background:color-mix(in srgb,var(--cd) 88%, transparent)}.pb>div{height:100%;background:linear-gradient(90deg,var(--im),var(--if))}
.tim{position:relative;height:34px;border:1px solid var(--bd);border-radius:12px;overflow:hidden}.sg{position:absolute;top:0;bottom:0}.mk{position:absolute;top:0;bottom:0;width:2px}.ml{position:absolute;top:2px;transform:translateX(-50%);font-size:9px;color:var(--mu);white-space:nowrap}.nmk{position:absolute;top:0;bottom:0;width:2px;background:var(--nw)}
.monh{padding:8px 10px;border-bottom:1px solid var(--bd);font-weight:700}.mon{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;padding:8px}.md{font-size:10px;color:var(--mu);text-align:center}.mc{min-height:56px;border:1px solid var(--bd);border-radius:10px;padding:4px;background:color-mix(in srgb,var(--cd) 88%, transparent);display:flex;flex-direction:column;gap:2px}.mc.bl{opacity:0}.mc.ac{cursor:pointer}.mc.in{background:rgba(66,133,244,.05)}.mc.to{outline:2px solid var(--ac)}.mc.se{box-shadow:inset 0 0 0 2px var(--ac)}.mc.ju{box-shadow:inset 0 0 0 2px color-mix(in srgb,var(--jm) 40%, transparent)}.mc .n{font-size:11px;font-weight:700}.mc .tm{font-size:9px;color:var(--mu)}
.tbl{overflow:auto}.tbl table{width:100%;border-collapse:separate;border-spacing:0;font-size:12px}.tbl th,.tbl td{padding:6px;border-bottom:1px solid var(--bd);white-space:nowrap}.tbl th{position:sticky;top:0;background:var(--cd);color:var(--mu)}.tbl tr.to{background:rgba(66,133,244,.08)}.tbl tr.ju{box-shadow:inset 3px 0 0 var(--jm)}
.field{margin-top:8px;border:1px solid var(--bd);border-radius:12px;padding:8px;background:color-mix(in srgb,var(--cd) 88%, transparent)}.sw{width:44px;height:25px;border:1px solid var(--bd);border-radius:999px;position:relative;background:var(--cd);cursor:pointer}.sw:after{content:'';position:absolute;top:2px;left:2px;width:19px;height:19px;border-radius:50%;background:var(--mu);transition:.15s}.sw.on{background:rgba(66,133,244,.12)}.sw.on:after{left:21px;background:var(--ac)}.og{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:6px}.om{border:1px solid var(--bd);border-radius:10px;padding:6px}.om div{font-size:11px;color:var(--mu);margin-bottom:3px}.om input{width:100%}
.toast{position:fixed;left:10px;right:10px;bottom:10px;z-index:70;background:var(--cd);border:1px solid var(--bd);border-radius:12px;padding:8px 10px;display:none}.toast.on{display:block}.toast b{font-size:13px}.toast div{font-size:12px;color:var(--mu)}
</style></head><body><div id='app'>
<div class='top'><div class='card pad'><div class='r'><div><div id='ttl' class='t1'></div><div id='sub' class='sm'></div></div><div id='db' class='sm'></div></div><div class='r' style='justify-content:flex-start;margin-top:4px'><span class='dot' style='background:var(--nw)'></span><span id='nowtxt' class='sm'></span><span id='nxb' class='sm' style='border:1px solid var(--bd);border-radius:999px;padding:2px 6px'></span></div></div></div>
<div class='card tabs' id='tabs'></div>
<div id='pages'><section id='cal'></section><section id='sum'></section><section id='day'></section><section id='mon'></section><section id='tab'></section><section id='set'></section></div>
<div id='toast' class='toast'><b id='to1'></b><div id='to2'></div></div>
<script>
(()=>{
const DATA=[
['2026-02-19','05:13','05:58','13:30','16:25','18:02','18:06','18:59'],['2026-02-20','05:12','05:57','13:30','16:26','18:03','18:07','19:00'],['2026-02-21','05:11','05:56','13:30','16:27','18:04','18:08','19:01'],['2026-02-22','05:10','05:55','13:30','16:27','18:04','18:09','19:02'],['2026-02-23','05:09','05:54','13:30','16:28','18:05','18:10','19:03'],['2026-02-24','05:08','05:53','13:30','16:29','18:06','18:10','19:03'],['2026-02-25','05:07','05:52','13:30','16:29','18:07','18:11','19:04'],['2026-02-26','05:06','05:51','13:30','16:30','18:07','18:12','19:05'],['2026-02-27','05:05','05:50','13:30','16:31','18:08','18:12','19:05'],['2026-02-28','05:04','05:49','13:30','16:31','18:09','18:13','19:06'],['2026-03-01','05:02','05:47','13:30','16:32','18:10','18:14','19:07'],['2026-03-02','05:01','05:46','13:30','16:33','18:10','18:15','19:08'],['2026-03-03','05:00','05:45','13:30','16:33','18:11','18:16','19:09'],['2026-03-04','04:59','05:44','13:30','16:34','18:12','18:16','19:09'],['2026-03-05','04:58','05:43','13:30','16:35','18:13','18:17','19:10'],['2026-03-06','04:57','05:42','13:30','16:35','18:14','18:18','19:11'],['2026-03-07','04:55','05:40','13:30','16:36','18:15','18:19','19:12'],['2026-03-08','04:54','05:39','13:30','16:36','18:15','18:20','19:13'],['2026-03-09','04:53','05:38','13:30','16:37','18:16','18:20','19:13'],['2026-03-10','04:52','05:37','13:30','16:37','18:17','18:21','19:14'],['2026-03-11','04:51','05:36','13:30','16:38','18:18','18:22','19:15'],['2026-03-12','04:49','05:34','13:30','16:38','18:18','18:23','19:16'],['2026-03-13','04:48','05:33','13:30','16:39','18:19','18:24','19:17'],['2026-03-14','04:47','05:32','13:30','16:40','18:20','18:24','19:17'],['2026-03-15','04:45','05:30','13:30','16:40','18:21','18:25','19:18'],['2026-03-16','04:44','05:29','13:30','16:41','18:21','18:26','19:19'],['2026-03-17','04:43','05:28','13:30','16:41','18:22','18:26','19:19'],['2026-03-18','04:42','05:27','13:30','16:42','18:22','18:27','19:20'],['2026-03-19','04:40','05:25','13:30','16:42','18:23','18:27','19:20'],['2026-03-20','04:39','05:24','13:30','16:42','18:24','18:28','19:21']
];
const P=['imsak','fajr','dhuhr','asr','iftar','maghrib','isha'],CK={imsak:'--im',fajr:'--fj',dhuhr:'--dh',asr:'--as',iftar:'--if',maghrib:'--mg',isha:'--is'};
const L={en:{tt:'Nanjing Ramadan Calendar 2026',sb:'Offline • single-file • Nanjing',tabs:['Calendar','Summary','Day','Month','Timetable','Settings'],today:'Today',prev:'Prev',next:'Next',week:'Week',day:'Day',go:'Go',roza:'Roza day',done:'Completed',left:'Left',status:'Status',nextp:'Next',ift:'To Iftar',seh:'To Sehri',prog:'Fast progress',jum:'Jumuah',rng:'Range',theme:'Theme',lang:'Language',fmt:'Time format',ws:'Week starts',mon:'Monday',sun:'Sunday',alerts:'Alerts',sound:'Sound',vib:'Vibration',dual:'Dual labels',shade:'Day/night shading',fshade:'Fasting shading',off:'Offsets',gof:'Global offset',mks:'Marker size',exp:'Export CSV',imp:'Import CSV',paste:'Paste CSV',apply:'Apply import',reset:'Reset',save:'Saved'},ur:{tt:'نانجنگ رمضان کیلنڈر 2026',sb:'آف لائن • ایک فائل • نانجنگ',tabs:['کیلنڈر','خلاصہ','دن','مہینہ','اوقات','ترتیبات'],today:'آج',prev:'پچھلا',next:'اگلا',week:'ہفتہ',day:'دن',go:'جائیں',roza:'روزہ نمبر',done:'مکمل',left:'باقی',status:'حالت',nextp:'اگلی نماز',ift:'افطار تک',seh:'اگلی سحری',prog:'روزے کی پیشرفت',jum:'جمعہ',rng:'مدت',theme:'تھیم',lang:'زبان',fmt:'وقت',ws:'ہفتہ شروع',mon:'پیر',sun:'اتوار',alerts:'الرٹس',sound:'آواز',vib:'وائبریشن',dual:'ڈوئل لیبل',shade:'دن/رات شیڈنگ',fshade:'روزہ شیڈنگ',off:'آفسیٹ',gof:'گلوبل',mks:'مارکر سائز',exp:'CSV ایکسپورٹ',imp:'CSV امپورٹ',paste:'CSV پیسٹ',apply:'امپورٹ',reset:'ری سیٹ',save:'محفوظ'},zh:{tt:'南京2026斋月日历',sb:'离线 • 单文件 • 南京',tabs:['日历','概览','当天','月份','时间表','设置'],today:'今天',prev:'上一',next:'下一',week:'周',day:'日',go:'前往',roza:'今日天数',done:'已完成',left:'剩余',status:'状态',nextp:'下一次',ift:'距开斋',seh:'距封斋',prog:'封斋进度',jum:'主麻',rng:'范围',theme:'主题',lang:'语言',fmt:'时间制',ws:'周开始',mon:'周一',sun:'周日',alerts:'提醒',sound:'声音',vib:'震动',dual:'双语标签',shade:'昼夜底色',fshade:'封斋底色',off:'偏移',gof:'全局',mks:'标记大小',exp:'导出CSV',imp:'导入CSV',paste:'粘贴CSV',apply:'应用',reset:'重置',save:'已保存'}};
const PN={en:{imsak:'Sehri',fajr:'Fajr',dhuhr:'Dhuhr',asr:'Asr',iftar:'Iftar',maghrib:'Maghrib',isha:'Isha',jum:'Jumuah'},ur:{imsak:'سحری',fajr:'فجر',dhuhr:'ظہر',asr:'عصر',iftar:'افطار',maghrib:'مغرب',isha:'عشاء',jum:'جمعہ'},zh:{imsak:'封斋',fajr:'晨礼',dhuhr:'晌礼',asr:'晡礼',iftar:'开斋',maghrib:'昏礼',isha:'宵礼',jum:'主麻'}};
const LS='ram_nj_v3';const DF={tab:0,view:'week',lang:'en',theme:'light',fmt:'24',ws:'monday',mk:1,alerts:1,sound:1,vib:1,dual:0,shade:1,fshade:1,goff:0,off:{imsak:0,fajr:0,dhuhr:0,asr:0,iftar:0,maghrib:0,isha:0}};
let S=Object.assign({},DF,JSON.parse(localStorage.getItem(LS)||'{}'));S.off=Object.assign({},DF.off,S.off||{});
let T=(JSON.parse(localStorage.getItem(LS+'_data')||'null')||DATA).map(a=>({date:a[0],imsak:a[1],fajr:a[2],dhuhr:a[3],asr:a[4],iftar:a[5],maghrib:a[6],isha:a[7]}));
let sel=today();let scr=JSON.parse(localStorage.getItem(LS+'_scr')||'{"x":0,"y":0}'); let aud;
function q(s,p=document){return p.querySelector(s)} function qa(s,p=document){return [...p.querySelectorAll(s)]}
function tr(k){return (L[S.lang]||L.en)[k]||k} function ttab(i){return (L[S.lang]||L.en).tabs[i]} function loc(){return S.lang=='ur'?'ur-PK':S.lang=='zh'?'zh-CN':'en-US'}
function pLab(k,j){let a=(PN[S.lang]||PN.en);let txt=(k==='dhuhr'&&j)?a.jum:a[k]; if(S.dual){let alt=S.lang==='ur'?PN.en[k]:PN.ur[k]; if(k==='dhuhr'&&j) alt=S.lang==='ur'?PN.en.jum:PN.ur.jum; txt += ' / '+alt} return txt}
function z(n){return String(n).padStart(2,'0')} function norm(t){let m=String(t||'').match(/(\d{1,2})[:：](\d{1,2})/); if(!m)return'00:00'; let h=Math.max(0,Math.min(23,+m[1])),mi=Math.max(0,Math.min(59,+m[2])); return z(h)+':'+z(mi)}
function m(t){let [h,mi]=norm(t).split(':').map(Number); return h*60+mi} function hm(x){x=Math.max(0,Math.min(1439,Math.round(x))); return z((x/60)|0)+':'+z(x%60)}
function tf(t){let x=m(t),h=(x/60)|0,mi=x%60; if(S.fmt==='24') return z(h)+':'+z(mi); let ap=h>=12?'PM':'AM',h12=h%12||12; return h12+':'+z(mi)+' '+ap}
function d(s){let [y,mn,dd]=s.split('-').map(Number); return new Date(y,mn-1,dd)} function ds(x){return x.getFullYear()+'-'+z(x.getMonth()+1)+'-'+z(x.getDate())} function today(){return ds(new Date())} function add(s,n){let x=d(s); x.setDate(x.getDate()+n); return ds(x)}
function wd(s,short=1){return new Intl.DateTimeFormat(loc(),{weekday:short?'short':'long'}).format(d(s))} function md(s){return new Intl.DateTimeFormat(loc(),{month:'short',day:'numeric'}).format(d(s))} function pd(s){return new Intl.DateTimeFormat(loc(),{year:'numeric',month:'short',day:'numeric',weekday:'short'}).format(d(s))}
function fri(s){return d(s).getDay()===5} function idx(s){let i=T.findIndex(r=>r.date===s); return i<0?0:i+1}
function er(r){let o={date:r.date}; P.forEach(k=>o[k]=hm(m(r[k]) + (+S.goff||0) + (+S.off[k]||0))); return o} function row(s){let r=T.find(x=>x.date===s); return r&&er(r)}
function evs(s){let r=row(s); if(!r) return []; return P.map(k=>({k,t:r[k],mi:m(r[k]),c:'var('+CK[k]+')',j:k==='dhuhr'&&fri(s),pr:k==='imsak'||k==='iftar'}))}
function visDates(){if(S.view==='day')return [sel]; let x=d(sel),w=x.getDay(),st=S.ws==='monday'?1:0; x.setDate(x.getDate()-((w-st+7)%7)); return [...Array(7)].map((_,i)=>ds(new Date(x.getFullYear(),x.getMonth(),x.getDate()+i)))}
function stateToday(){let t=today(),r=row(t),f=T[0].date,l=T[T.length-1].date,n=new Date(),nm=n.getHours()*60+n.getMinutes()+n.getSeconds()/60,res={t,r,f,l}; if(!r){res.in=0;res.comp=t<f?0:T.length;res.left=T.length-res.comp;res.day=t<f?0:T.length;res.stat=t<f?'before':'after';res.pct=res.comp/T.length;res.fp=0; return res} let im=m(r.imsak),ifm=m(r.iftar);res.in=1;res.day=idx(t);res.comp=res.day-1+(nm>=ifm?1:0);res.left=T.length-res.comp;res.pct=res.comp/T.length;res.stat=nm<im?'pre':(nm<ifm?'fast':'post'); let st=new Date(d(t)); st.setHours((im/60)|0,im%60,0,0); let en=new Date(d(t)); en.setHours((ifm/60)|0,ifm%60,0,0); res.fp=Math.max(0,Math.min(1,(Date.now()-st)/(en-st))); return res}
function nextPrayer(s=today()){let rs=row(s); if(!rs) return null; let base=d(s),now=s===today()?new Date():new Date(base.getFullYear(),base.getMonth(),base.getDate(),0,0,0,0),arr=evs(s).map(e=>({...e,dt:new Date(base.getFullYear(),base.getMonth(),base.getDate(),(e.mi/60)|0,e.mi%60,0,0)})); let nx=arr.find(e=>e.dt>now); if(nx) return {...nx,date:s,left:nx.dt-now}; let s2=add(s,1),r2=row(s2); if(!r2) return null; let e=evs(s2)[0],b2=d(s2),dt=new Date(b2.getFullYear(),b2.getMonth(),b2.getDate(),(e.mi/60)|0,e.mi%60,0,0); return {...e,date:s2,left:dt-now}
}
function save(){localStorage.setItem(LS,JSON.stringify(S)); localStorage.setItem(LS+'_data',JSON.stringify(T.map(r=>[r.date,r.imsak,r.fajr,r.dhuhr,r.asr,r.iftar,r.maghrib,r.isha])))}
function toast(a,b=''){q('#to1').textContent=a; q('#to2').textContent=b; q('#toast').classList.add('on'); clearTimeout(window.ttm); window.ttm=setTimeout(()=>q('#toast').classList.remove('on'),2500)}
function beep(){try{let C=window.AudioContext||window.webkitAudioContext; if(!C)return; aud=aud||new C(); if(aud.state==='suspended')aud.resume(); let o=aud.createOscillator(),g=aud.createGain(); o.frequency.value=820; o.connect(g); g.connect(aud.destination); let t=aud.currentTime; g.gain.value=.0001; g.gain.exponentialRampToValueAtTime(.06,t+.01); g.gain.exponentialRampToValueAtTime(.0001,t+.22); o.start(t); o.stop(t+.24)}catch(e){}}
function topBar(){document.body.classList.toggle('dk',S.theme==='dark'); q('#ttl').textContent=tr('tt'); q('#sub').textContent=tr('sb'); q('#db').textContent=new Intl.DateTimeFormat(loc(),{month:'short',day:'numeric'}).format(new Date()); q('#nowtxt').textContent='Now: '+new Intl.DateTimeFormat(loc(),{hour:'numeric',minute:'2-digit',second:'2-digit'}).format(new Date()); let n=nextPrayer(); q('#nxb').textContent=n?`${tr('nextp')}: ${pLab(n.k,n.j)} • ${dur(n.left)}`:'--'; }
function dur(ms){ms=Math.max(0,ms); let s=(ms/1000)|0,h=(s/3600)|0,mn=((s%3600)/60)|0,se=s%60; return h?`${h}h ${mn}m ${se}s`:`${mn}m ${se}s`}
function tabs(){let b=q('#tabs'); b.innerHTML=[0,1,2,3,4,5].map(i=>`<button class='${S.tab===i?'on':''}' data-i='${i}'>${ttab(i)}</button>`).join(''); qa('button',b).forEach(x=>x.onclick=()=>{S.tab=+x.dataset.i; save(); pages()}) }
function pages(){qa('#pages>section').forEach((s,i)=>s.classList.toggle('on',i===S.tab))}
function cal(){let v=visDates(),cw=S.view==='day'?Math.max(240,Math.min(380,innerWidth-92)):138,hh=S.view==='day'?92:74,H=hh*24,ppm=hh/60,t=today(); let html=`<div class='card pad'><div class='r'><div class='seg'><button class='${S.view==='week'?'on':''}' id='vw'>${tr('week')}</button><button class='${S.view==='day'?'on':''}' id='vd'>${tr('day')}</button></div><button class='btn g' id='pr'>${tr('prev')}</button><button class='btn g' id='nx'>${tr('next')}</button><button class='btn p' id='td'>${tr('today')}</button><input type='date' id='cd' class='in' value='${sel}'><button class='btn' id='cg'>${tr('go')}</button></div><div class='legend'>`;
 P.forEach(k=>html+=`<div class='lg'><span class='dot' style='background:var(${CK[k]})'></span>${pLab(k,false)}</div>`); html+=`<div class='lg'><span class='dot' style='background:var(--nw)'></span>Live</div><div class='lg'><span class='dot' style='background:var(--fa)'></span>Fasting</div></div></div>`;
 html+=`<div class='card cwrap' style='--cw:${cw}px;--cc:${v.length};--hh:${hh}px;--H:${H}px;--mk:${[0.85,1,1.15,1.3][S.mk]||1}'><div class='hsc' id='hs'><div class='hin'><div class='rh'></div>`;
 v.forEach(s=>{let j=fri(s),rv=T.find(r=>r.date===s); html+=`<div class='dh ${s===t?'to':''} ${s===sel?'se':''} ${j?'ju':''}' data-s='${s}'><div class='a'>${wd(s,1)}</div><div class='b'>${md(s)}</div>${rv?`<div class='a'>R${String(idx(s)).padStart(2,'0')}</div>`:''}${j?`<div class='jb'>${tr('jum')}</div>`:''}</div>`}); html+=`</div></div><div class='bsc' id='bs'><div class='bin'><div class='rail'>`;
 for(let i=0;i<24;i++) html+=`<div class='tl' style='top:${i*hh}px'>${tf(z(i)+':00')}</div>`; html+=`</div>`;
 v.forEach((s,i)=>{let x=54+i*cw,rv=row(s),j=fri(s); html+=`<div class='col ${s===t?'to':''} ${j?'ju':''}' style='left:${x}px'>`; if(rv){let fj=m(rv.fajr),mg=m(rv.maghrib),im=m(rv.imsak),it=m(rv.iftar); if(S.shade){html+=`<div class='bnd ni' style='top:0;height:${fj*ppm}px'></div><div class='bnd dy' style='top:${fj*ppm}px;height:${(mg-fj)*ppm}px'></div><div class='bnd ni' style='top:${mg*ppm}px;height:${(1440-mg)*ppm}px'></div>`} if(S.fshade) html+=`<div class='bnd fa' style='top:${im*ppm}px;height:${(it-im)*ppm}px'></div>`; let lanes=[]; evs(s).forEach(e=>{let y=e.mi*ppm; html+=`<div class='ln' style='top:${y}px;background:var(${CK[e.k]})'></div>`; let lane=0; while(lanes[lane]!=null&&lanes[lane]>y-2)lane++; lanes[lane]=y+22; let left=4+lane*(S.view==='day'?84:54),txt=S.view==='day'?pLab(e.k,e.j):(e.k==='dhuhr'&&e.j?tr('jum'):pLab(e.k,e.j)); html+=`<div class='ch ${S.view==='day'?'w':''} ${(e.k==='iftar'||e.k==='maghrib')?'k':''} ${e.j?'ju':''}' style='top:${Math.max(0,y-(e.pr?10:9))}px;left:${left}px;background:var(${CK[e.k]})'>${txt}</div>`}) }
 if(s===t){let n=new Date(),y=(n.getHours()*60+n.getMinutes()+n.getSeconds()/60)*ppm; html+=`<div class='now' style='top:${y}px'><span>Now</span></div>`}
 html+='</div>'}); html+='</div></div></div>'; q('#cal').innerHTML=html;
 q('#vw').onclick=()=>{S.view='week';save();render()}; q('#vd').onclick=()=>{S.view='day';save();render()}; q('#pr').onclick=()=>{capScr(); sel=add(sel,S.view==='week'?-7:-1); render()}; q('#nx').onclick=()=>{capScr(); sel=add(sel,S.view==='week'?7:1); render()}; q('#td').onclick=()=>{sel=today(); render()}; q('#cg').onclick=()=>{let v=q('#cd').value; if(v)sel=v; render()}; qa('.dh',q('#cal')).forEach(x=>x.onclick=()=>{sel=x.dataset.s; S.tab=2; save(); render()});
 let hs=q('#hs'),bs=q('#bs'); bs.onscroll=()=>{hs.scrollLeft=bs.scrollLeft; scr={x:bs.scrollLeft,y:bs.scrollTop}; localStorage.setItem(LS+'_scr',JSON.stringify(scr))}; hs.onscroll=()=>bs.scrollLeft=hs.scrollLeft; bs.scrollLeft=scr.x||0; bs.scrollTop=scr.y||0; if(!(scr.y>0)){let n=new Date(); bs.scrollTop=Math.max(0,((n.getHours()*60+n.getMinutes())-120)*ppm)} }
function sum(){let st=stateToday(),n=nextPrayer(); let stat=st.stat==='before'?'Before Ramadan':st.stat==='after'?'After Ramadan':st.stat==='pre'?'Before Sehri cutoff':st.stat==='fast'?'Fasting in progress':'After Iftar'; if(S.lang==='ur') stat=st.stat==='before'?'رمضان سے پہلے':st.stat==='after'?'رمضان ختم':st.stat==='pre'?'سحری سے پہلے':st.stat==='fast'?'روزہ جاری':'افطار کے بعد'; if(S.lang==='zh') stat=st.stat==='before'?'尚未开始':st.stat==='after'?'已结束':st.stat==='pre'?'封斋前':st.stat==='fast'?'正在封斋':'开斋后'; let r=st.r; q('#sum').innerHTML=`<div class='card pad'><div class='r'><div><div style='font-weight:700'>${ttab(1)}</div><div class='sm'>${tr('rng')}: ${pd(st.f)} → ${pd(st.l)}</div></div><button class='btn p' id='sdt'>${tr('today')}</button></div></div>
<div class='g3'><div class='m'><div class='k'>${tr('roza')}</div><div class='v'>${st.day}/${T.length}</div></div><div class='m'><div class='k'>${tr('done')}</div><div class='v'>${st.comp}</div></div><div class='m'><div class='k'>${tr('left')}</div><div class='v'>${st.left}</div></div></div>
<div class='card pad'><div class='m'><div class='k'>${tr('status')}</div><div class='v' style='font-size:16px'>${stat}</div></div>${r?`<div style='margin-top:8px' class='g2'><div class='list'>${['imsak','fajr','dhuhr','asr'].map(k=>sr(k,r[k],fri(st.t)&&k==='dhuhr')).join('')}</div><div class='list'>${['iftar','maghrib','isha'].map(k=>sr(k,r[k],0)).join('')}${n?`<div class='rr'><div class='lf'><span class='pd' style='background:var(${CK[n.k]})'></span><div><div class='nm'>${tr('nextp')}</div><div class='nt'>${pLab(n.k,n.j)}</div></div></div><div style='font-weight:700'>${dur(n.left)}</div></div>`:''}</div></div><div style='margin-top:8px' class='sm'>${tr('prog')}</div><div class='pb'><div style='width:${(st.fp*100).toFixed(1)}%'></div></div>`:`<div class='sm' style='margin-top:8px'>Outside range</div>`}</div>`; q('#sdt').onclick=()=>{sel=today();S.tab=2;save();render()}}
function sr(k,t,j){return `<div class='rr'><div class='lf'><span class='pd' style='background:var(${CK[k]})'></span><div class='nm'>${pLab(k,j)}</div></div><div style='font-weight:${k==='imsak'||k==='iftar'?800:600}'>${tf(t)}</div></div>`}
function dayv(){let s=sel,r=row(s),isT=s===today(),e=evs(s),nx=nextPrayer(isT?s:s),n=new Date(),html=`<div class='card pad'><div class='r'><div><div style='font-weight:700'>${ttab(2)}</div><div class='sm'>${pd(s)} ${fri(s)?'• '+tr('jum'):''}</div></div><div class='r'><input type='date' id='dd' class='in' value='${s}'><button class='btn p' id='dt'>${tr('today')}</button></div></div></div>`; if(!r){q('#day').innerHTML=html+`<div class='card pad'><div class='sm'>Outside range</div></div>`; q('#dd').onchange=e=>{sel=e.target.value;render()}; q('#dt').onclick=()=>{sel=today();render()}; return}
 let iftDt=new Date(d(s)); iftDt.setHours((m(r.iftar)/60)|0,m(r.iftar)%60,0,0); let nxIm=row(add(s,1)); let seh='--'; if(nxIm){ let nd=d(add(s,1)); nd.setHours((m(nxIm.imsak)/60)|0,m(nxIm.imsak)%60,0,0); seh=isT?dur(nd-n):tf(nxIm.imsak)}
 let ift=isT?dur(iftDt-n):tf(r.iftar),fjp=m(r.fajr),mgp=m(r.maghrib),imp=m(r.imsak),itp=m(r.iftar),p=isT?Math.max(0,Math.min(1,(Date.now()-new Date(d(s)).setHours((imp/60)|0,imp%60,0,0))/(iftDt-new Date(d(s)).setHours((imp/60)|0,imp%60,0,0)))):0;
 html+=`<div class='g2'><div class='m'><div class='k'>${tr('nextp')}</div><div class='v' style='font-size:16px'>${nx? pLab(nx.k,nx.j):'--'}</div><div class='sm'>${nx?(isT?dur(nx.left):tf(nx.t)):''}</div></div><div class='m'><div class='k'>${tr('status')}</div><div class='v' style='font-size:16px'>${isT?(Date.now()<new Date(d(s)).setHours((imp/60)|0,imp%60,0,0)?'Pre-Sehri':Date.now()<iftDt?'Fasting':'After Iftar'):pd(s)}</div></div></div>
<div class='g2'><div class='m'><div class='k'>${tr('ift')}</div><div class='v'>${ift}</div></div><div class='m'><div class='k'>${tr('seh')}</div><div class='v'>${seh}</div></div></div>
<div class='card pad'><div class='sm'>${tr('prog')}</div><div class='pb'><div style='width:${(p*100).toFixed(1)}%'></div></div><div class='tim' style='margin-top:8px'>${S.shade?`<div class='sg' style='left:0;width:${fjp/14.4}%;background:var(--ni)'></div><div class='sg' style='left:${fjp/14.4}%;width:${(mgp-fjp)/14.4}%;background:var(--dy)'></div><div class='sg' style='left:${mgp/14.4}%;width:${(1440-mgp)/14.4}%;background:var(--ni)'></div>`:''}${S.fshade?`<div class='sg' style='left:${imp/14.4}%;width:${(itp-imp)/14.4}%;background:var(--fa)'></div>`:''}${e.map(v=>`<div class='mk' style='left:${v.mi/14.4}%;background:var(${CK[v.k]})'></div><div class='ml' style='left:${v.mi/14.4}%'>${v.k==='dhuhr'&&v.j?tr('jum'):pLab(v.k,v.j)}</div>`).join('')}${isT?`<div class='nmk' style='left:${((n.getHours()*60+n.getMinutes()+n.getSeconds()/60)/14.4)}%'></div>`:''}</div></div>
<div class='card pad'><div style='font-weight:700;margin-bottom:6px'>Prayer timeline</div><div class='list'>${e.map(v=>{let dt=new Date(d(s));dt.setHours((v.mi/60)|0,v.mi%60,0,0);let st=isT?(Math.abs(dt-n)<30000?'Now':dt<n?'Passed':'Upcoming'):pd(s);return`<div class='rr'><div class='lf'><span class='pd' style='background:var(${CK[v.k]})'></span><div><div class='nm'>${pLab(v.k,v.j)}</div><div class='nt'>${tf(v.t)}</div></div></div><div class='pill'>${st}</div></div>`}).join('')}</div></div>`;
 q('#day').innerHTML=html; q('#dd').onchange=e=>{sel=e.target.value;render()}; q('#dt').onclick=()=>{sel=today();render()}}
function month(){let ms=[...new Set(T.map(r=>r.date.slice(0,7)))],out=`<div class='card pad'><div style='font-weight:700'>${ttab(3)}</div><div class='sm'>${tr('jum')} highlighted • tap day to open</div></div>`; ms.forEach(mo=>{let [y,mm]=mo.split('-').map(Number),fd=new Date(y,mm-1,1),ld=new Date(y,mm,0),ws=S.ws==='monday'?1:0,pad=(fd.getDay()-ws+7)%7; out+=`<div class='card' style='margin-top:8px'><div class='monh'>${new Intl.DateTimeFormat(loc(),{month:'long',year:'numeric'}).format(fd)}</div><div class='mon'>`; for(let i=0;i<7;i++){let k=(ws+i)%7,ref=new Date(2026,1,1+k); out+=`<div class='md'>${new Intl.DateTimeFormat(loc(),{weekday:'short'}).format(ref)}</div>`} for(let i=0;i<pad;i++) out+=`<div class='mc bl'></div>`; for(let day=1;day<=ld.getDate();day++){let s=ds(new Date(y,mm-1,day)),r=row(s),j=fri(s); out+=`<div class='mc ${r?'ac in':''} ${s===today()?'to':''} ${s===sel?'se':''} ${j?'ju':''}' data-s='${s}'><div class='n'>${day}</div>${r?`<div class='tm'>${tf(r.imsak)}</div><div class='tm'>${tf(r.iftar)}</div>`:''}</div>`} out+='</div></div>'}); q('#mon').innerHTML=out; qa('.mc.ac',q('#mon')).forEach(x=>x.onclick=()=>{sel=x.dataset.s;S.tab=2;save();render()})}
function table(){let rows=T.map(er),out=`<div class='card pad'><div class='r'><div><div style='font-weight:700'>${ttab(4)}</div><div class='sm'>Exact times (with offsets applied)</div></div><button class='btn g' id='exp'>${tr('exp')}</button></div></div><div class='card pad' style='margin-top:8px'><div class='r'><input id='fup' type='file' class='in' accept='.csv,text/csv'><button id='impf' class='btn'>${tr('imp')}</button></div><div class='field'><div class='sm' style='margin-bottom:6px'>${tr('paste')}</div><textarea id='csvt' class='in' style='width:100%;min-height:86px' placeholder='date,imsak,fajr,dhuhr,asr,iftar,maghrib,isha'></textarea><div class='r' style='margin-top:6px'><button id='appcsv' class='btn'>${tr('apply')}</button><button id='rstcsv' class='btn g'>${tr('reset')}</button></div></div></div><div class='card pad tbl' style='margin-top:8px'><table><thead><tr><th>#</th><th>Date</th><th>Day</th>${P.map(k=>`<th>${pLab(k,0)}</th>`).join('')}</tr></thead><tbody>`; rows.forEach((r,i)=>{out+=`<tr class='${r.date===today()?'to':''} ${fri(r.date)?'ju':''}'><td>${i+1}</td><td>${r.date}</td><td>${wd(r.date,1)}</td>${P.map(k=>`<td>${tf(r[k])}</td>`).join('')}</tr>`}); out+='</tbody></table></div>'; q('#tab').innerHTML=out;
 q('#exp').onclick=()=>{let hdr=['date',...P],txt=[hdr.join(',')]; rows.forEach(r=>txt.push(hdr.map(k=>r[k]).join(','))); let a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([txt.join('\n')],{type:'text/csv'})); a.download='nanjing-ramadan-2026.csv'; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),1000)};
 q('#impf').onclick=async()=>{let f=q('#fup').files&&q('#fup').files[0]; if(!f)return; parseCsv(await f.text())}; q('#appcsv').onclick=()=>{let tx=q('#csvt').value.trim(); if(tx) parseCsv(tx)}; q('#rstcsv').onclick=()=>{T=DATA.map(a=>({date:a[0],imsak:a[1],fajr:a[2],dhuhr:a[3],asr:a[4],iftar:a[5],maghrib:a[6],isha:a[7]})); save(); toast(tr('reset')); render()}; }
function parseCsv(tx){try{let ls=tx.replace(/\r/g,'').trim().split('\n').filter(Boolean),sp=l=>{let o=[],c='',qf=0; for(let i=0;i<l.length;i++){let ch=l[i]; if(ch==='"'){if(qf&&l[i+1]==='"'){c+='"';i++} else qf=!qf} else if(ch===','&&!qf){o.push(c);c=''} else c+=ch} o.push(c); return o.map(v=>v.trim())}; if(!ls.length) throw Error('empty'); let h=sp(ls[0]).map(v=>v.toLowerCase()),iDate=h.indexOf('date'); let rows=[]; if(iDate>=0){let id={date:iDate,imsak:h.indexOf('imsak'),fajr:h.indexOf('fajr'),dhuhr:h.indexOf('dhuhr'),asr:h.indexOf('asr'),iftar:h.indexOf('iftar'),maghrib:h.indexOf('maghrib'),isha:h.indexOf('isha')}; for(let j=1;j<ls.length;j++){let c=sp(ls[j]); if(c.length<2) continue; let r={}; P.concat('date').forEach(k=>{}); r.date=c[id.date]; P.forEach(k=>r[k]=norm(c[id[k]]||'00:00')); rows.push(r)} } else {ls.forEach(l=>{let c=sp(l); if(c.length<8) return; rows.push({date:c[0],imsak:norm(c[1]),fajr:norm(c[2]),dhuhr:norm(c[3]),asr:norm(c[4]),iftar:norm(c[5]),maghrib:norm(c[6]),isha:norm(c[7])})})}
 if(!rows.length) throw Error('no rows'); T=rows.sort((a,b)=>a.date.localeCompare(b.date)); save(); toast('Imported',rows.length+' rows'); render()}catch(e){toast('Import failed',e.message)}}
function settings(){let out=`<div class='card pad'><div style='font-weight:700'>${ttab(5)}</div><div class='sm'>Mobile offline friendly • dark mode uses dark gray</div></div>
<div class='field'><div class='r'><div>${tr('theme')}</div><div class='seg'><button id='thl' class='${S.theme==='light'?'on':''}'>Light</button><button id='thd' class='${S.theme==='dark'?'on':''}'>Dark</button></div></div></div>
<div class='field'><div class='sm'>${tr('lang')}</div><select id='lng' class='in' style='width:100%;margin-top:5px'><option value='en' ${S.lang==='en'?'selected':''}>English</option><option value='ur' ${S.lang==='ur'?'selected':''}>اردو</option><option value='zh' ${S.lang==='zh'?'selected':''}>中文</option></select></div>
<div class='field'><div class='r'><div>${tr('fmt')}</div><div class='seg'><button id='f24' class='${S.fmt==='24'?'on':''}'>24h</button><button id='f12' class='${S.fmt==='12'?'on':''}'>12h</button></div></div></div>
<div class='field'><div class='sm'>${tr('ws')}</div><select id='ws' class='in' style='width:100%;margin-top:5px'><option value='monday' ${S.ws==='monday'?'selected':''}>${tr('mon')}</option><option value='sunday' ${S.ws==='sunday'?'selected':''}>${tr('sun')}</option></select></div>
<div class='field'><div class='sm'>${tr('mks')}</div><input id='mkr' type='range' min='0' max='3' step='1' value='${S.mk}' style='width:100%'></div>
${tog('alerts',tr('alerts'),S.alerts)}${tog('sound',tr('sound'),S.sound)}${tog('vib',tr('vib'),S.vib)}${tog('dual',tr('dual'),S.dual)}${tog('shade',tr('shade'),S.shade)}${tog('fshade',tr('fshade'),S.fshade)}
<div class='field'><div class='sm' style='margin-bottom:6px'>${tr('off')}</div><div class='og'><div class='om'><div>${tr('gof')}</div><input class='in' id='goff' type='number' value='${S.goff}'></div>${P.map(k=>`<div class='om'><div>${pLab(k,0)}</div><input class='in' type='number' data-o='${k}' value='${S.off[k]||0}'></div>`).join('')}</div><div class='sm' style='margin-top:6px'>Use negative numbers for earlier markers/reminders.</div></div>
<div class='field'><div class='r'><button class='btn g' id='rst'>${tr('reset')}</button><button class='btn' id='savebtn'>${tr('save')}</button></div></div>`; q('#set').innerHTML=out;
 q('#thl').onclick=()=>{S.theme='light';save();render()}; q('#thd').onclick=()=>{S.theme='dark';save();render()}; q('#lng').onchange=e=>{S.lang=e.target.value;save();render()}; q('#f24').onclick=()=>{S.fmt='24';save();render()}; q('#f12').onclick=()=>{S.fmt='12';save();render()}; q('#ws').onchange=e=>{S.ws=e.target.value;save();render()}; q('#mkr').onchange=e=>{S.mk=+e.target.value;save();render()}; qa('.sw',q('#set')).forEach(x=>x.onclick=()=>{let k=x.dataset.k; S[k]=S[k]?0:1; save(); render()}); q('#goff').onchange=e=>{S.goff=+e.target.value||0;save();render()}; qa('[data-o]',q('#set')).forEach(x=>x.onchange=()=>{S.off[x.dataset.o]=+x.value||0;save();render()}); q('#rst').onclick=()=>{S=JSON.parse(JSON.stringify(DF)); save(); render()}; q('#savebtn').onclick=()=>toast(tr('save')) }
function tog(k,l,v){return `<div class='field'><div class='r'><div>${l}</div><div class='sw ${v?'on':''}' data-k='${k}'></div></div></div>`}
function render(){topBar();tabs();cal();sum();dayv();month();table();settings();pages()}
function capScr(){let b=q('#bs'); if(b){scr={x:b.scrollLeft,y:b.scrollTop}; localStorage.setItem(LS+'_scr',JSON.stringify(scr))}}
function checkAlert(){if(!S.alerts) return; let t=today(),r=row(t); if(!r)return; let n=new Date(),hh=z(n.getHours())+':'+z(n.getMinutes()),key=t+' '+hh;if(localStorage.getItem(LS+'_a')===key)return; let e=evs(t).find(x=>x.t===hh); if(e){localStorage.setItem(LS+'_a',key); toast(pLab(e.k,e.j),'Now • '+tf(e.t)); if(S.vib&&navigator.vibrate)navigator.vibrate([120,50,120]); if(S.sound)beep()}}
render(); setInterval(()=>{topBar(); if(S.tab===0){capScr(); cal(); pages()} if(S.tab===1) sum(); if(S.tab===2) dayv(); checkAlert()},1000); document.addEventListener('click',()=>{if(aud&&aud.state==='suspended')aud.resume().catch(()=>{})},{passive:true});
})();
</script></body></html>
